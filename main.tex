% Institute of Computer Science thesis template
% authors: Sven Laur, Liina Kamm
% last change Tõnu Tamme 03.05.2019
%--
% Compilation instructions:
% 1. Choose main language on line 55-56 (English or Estonian)
% 2. Compile 1-3 times to get refences right
% pdflatex bachelors-thesis-template
% bibtex bachelors-thesis-template
%--
% Please use references like this:
% <text> <non-breaking-space> <cite/ref-command> <punctuation>
% This is an example~\cite{example}.
\documentclass[12pt]{article}

% A package for setting layout and margins for your thesis 
\usepackage[a4paper]{geometry}

%%=== A4 page setup ===
%\setlength{\paperwidth}{21.0cm} 
%\setlength{\paperheight}{29.7cm}
%\setlength{\textwidth}{16cm}
%\setlength{\textheight}{25cm}
%float package
\usepackage{float}
\usepackage[section]{placeins}
%to remove the boxes around the hyperlinks
%package for under script
\usepackage{accents}
% package for degree symbol
\usepackage{gensymb}

% When you write in Estonian then you want to use text with right character set
% By default LaTeX does not know what to do with õäöu letters. You have to specify
% a correct input and font encoding. For that you have to Google the Web     
%
% For TexShop under MacOS X. The right lines are 
%\usepackage[applemac]{inputenc}
%\usepackage[T1]{fontenc} %Absolutely critical for *hyphenation* of words with non-ASCII letters.
%
% For Windows and Linux the right magic lines are   
% \usepackage[latin1]{inputenc}
% \usepackage[latin5]{inputenc}
%
\usepackage[utf8x]{inputenc} %standard encoding since 2018 (can be commented out?)
\usepackage[T1]{fontenc} %Absolutely critical for *hyphenation* of words with non-ASCII letters.

% Typeset text in Times Roman instead of Computer Modern (EC)
\usepackage{times}

% Suggested packages:
\usepackage{microtype}  %towards typographic perfection...
\usepackage{inconsolata} %nicer font for code listings. (Use \ttfamily for lstinline bastype)


% Use package babel for English or Estonian 
% If you use Estonian make sure that Estonian hyphenation is installed 
% - hypen-estonian or eehyp packages
%
%===Choose the main language in thesis
\usepackage[estonian, english]{babel} %the thesis is in English 
%\usepackage[english, estonian]{babel} %the thesis is in Estonian
\usepackage{lipsum}  

\usepackage{blindtext}

% Change Babel document elements 
\addto\captionsestonian{%
  \renewcommand{\refname}{Viidatud kirjandus}%
  \renewcommand{\appendixname}{Lisad}%
}

%natbib for vancouver style biblography
\usepackage[numbers,sort]{natbib} 

% If you have problems with Estonian keywords in the bibliography
%\usepackage{biblatex}
%\usepackage[backend=biber]{biblatex}
%\usepackage[style=alphabetic]{biblatex}
%% plain --> \usepackage[style=numeric]{biblatex}
%% abbrv --> \usepackage[style=numeric,firstinits=true]{biblatex}
%% unsrt --> \usepackage[style=numeric,sorting=none]{biblatex}
%% alpha --> \usepackage[style=alphabetic]{biblatex}
%\DefineBibliographyStrings{estonian}{and={ja}}

% General packages for math in general, theorems and symbols 
% Read ftp://ftp.ams.org/ams/doc/amsmath/short-math-guide.pdf for further information
\usepackage{amsmath} 
\usepackage{amsthm}
\usepackage{amssymb}

% Optional calligraphic fonts    
% \usepackage[mathscr]{eucal}

% Print a dot instead of colon in table or figure captions
\usepackage[labelsep=period]{caption}

% Packages for building tables and tabulars 
\usepackage{array}
\usepackage{tabu}   % Wide lines in tables
\usepackage{xspace} % Non-eatable spaces in macros
% Including graphical images and setting the figure directory
\usepackage{graphicx}
\usepackage{subcaption}

% Packages for getting clickable links in PDF file
%\usepackage{hyperref}
\usepackage[hidelinks]{hyperref} %hide red (blue,green) boxes around links
\usepackage[all]{hypcap}


% Packages for defining colourful text together with some colours
\usepackage{color}
\usepackage{xcolor} 
%\definecolor{dkgreen}{rgb}{0,0.6,0}
%\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}


% Standard package for drawing algorithms
% Since the thesis in article format we must define \chapter for
% the package algorithm2e (otherwise obscure errors occur) 
\let\chapter\section
\usepackage[ruled, vlined, linesnumbered]{algorithm2e}

% Fix a  set of keywords which you use inside algorithms
\SetKw{True}{true}
\SetKw{False}{false}
\SetKwData{typeInt}{Int}
\SetKwData{typeRat}{Rat}
\SetKwData{Defined}{Defined}
\SetKwFunction{parseStatement}{parseStatement}


% Nice todo notes
\setlength {\marginparwidth }{2cm} %to-do margin
\usepackage{todonotes}

% comments and verbatim text (code)
\usepackage{verbatim}

%package for AMS style


% Proper way to create coloured code listings
\usepackage{listings}
\lstset{ 
  %language=python,                % the language of the code
  language=C++,
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  %numbers=left,                   % where to put the line-numbers
  %numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
  numberstyle=\tiny\color{gray}, 
  stepnumber=1,                    % the step between two line-numbers. If it's 1, each line 
                                   % will be numbered
  numbersep=5pt,                   % how far the line-numbers are from the code
  backgroundcolor=\color{white},   % choose the background color. You must add \usepackage{color}
  showspaces=false,                % show spaces adding particular underscores
  showstringspaces=false,          % underline spaces within strings
  showtabs=false,                  % show tabs within strings adding particular underscores
  frame = lines,
  %frame=single,                   % adds a frame around the code
  rulecolor=\color{black},		   % if not set, the frame-color may be changed on line-breaks within 
                                   % not-black text (e.g. commens (green here))
  tabsize=2,                       % sets default tabsize to 2 spaces
  captionpos=b,                    % sets the caption-position to bottom
  breaklines=true,                 % sets automatic line breaking
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  %title=\lstname,                 % show the filename of files included with \lstinputlisting;
                                   % also try caption instead of title
  keywordstyle=\color{blue},       % keyword style
  commentstyle=\color{dkgreen},    % comment style
  stringstyle=\color{mauve},       % string literal style
  escapeinside={\%*}{*)},          % if you want to add a comment within your code
  morekeywords={*,game, fun}       % if you want to add more keywords to the set
}


% Obscure packages to write logic formulae and program semantics
% Unless you do a bachelor thesis on program semantics or static code analysis you do not need that
% http://logicmatters.net/resources/ndexamples/proofsty3.html <= writing type rules => use semantic::inference
% ftp://tug.ctan.org/tex-archive/macros/latex/contrib/semantic/semantic.pdf
\usepackage{proof}
\usepackage{semantic} 
\setlength{\inferLineSkip}{4pt}
\def\predicatebegin #1\predicateend{$\Gamma \vdash #1$}

% If you really want to draw figures in LaTeX use packages tikz or pstricks
% However, getting a corresponding illustrations is really painful  


% Define your favorite macros that you use inside the thesis 
% Name followed by non-removable space
\newcommand{\proveit}{ProveIt\xspace}

% Macros that make sure that the math mode is set
\newcommand{\typeF}[1] {\ensuremath{\mathsf{type_{#1}}}\xspace}
\newcommand{\opDiv}{\ensuremath{\backslash \mathsf{div}}\xspace} 

% Nice Todo box
\newcommand{\TODO}{\todo[inline]}

% A way to define theorems and lemmata
\newtheorem{theorem}{Theorem}
%\renewcommand{\baselinestretch}{1.5}
\linespread{1.4} % Line spacing between each line



%%% BEGIN DOCUMENT
\begin{document}

%===BEGIN TITLE PAGE
\thispagestyle{empty}
\begin{center}

\iflanguage{english}{%
\large
UNIVERSITY OF TARTU\\%[2mm]
Institute of Computer Science\\
Computer Science Curriculum\\%[2mm]
}{%
TARTU ÜLIKOOL\\
Arvutiteaduse instituut\\
Informaatika õppekava\\%[2mm]
}%\iflanguage

%\vspace*{\stretch{5}}
\vspace{25mm}

\Large Nishant Poddar

\vspace{4mm}

\huge Coverage Analysis of LPWAN in Estonia: Sigfox and NB-IoT Case study in Tallinn and Tartu

%\vspace*{\stretch{7}}
\vspace{20mm}

\iflanguage{english}{%
\Large Master's Thesis (30 ECTS)
}{%
\Large Bakalaureusetöö (9 EAP)
}%\iflanguage

\end{center}

\vspace{2mm}

\begin{flushright}
 {
 \setlength{\extrarowheight}{5pt}
 \begin{tabular}{r l} 
  \sffamily \iflanguage{english}{Supervisor}{Juhendaja}: & \sffamily Jakob Mass, Msc, University of Tartu\\
  \sffamily \iflanguage{english}{Co-Supervisor}{Juhendaja}: & \sffamily Sikandar Khan, Msc, Tallinn University of Technology, Tallinn\\
   \sffamily \iflanguage{english}{Advisor}{Juhendaja}: & \sffamily Petri Makela, Network Engineer, Connected Finland OY
  
  
 \end{tabular}
 }
\end{flushright}

%\vspace*{\stretch{3}}
%\vspace{10mm}

\vfill
\centerline{Tartu 2020}

%===END TITLE PAGE

% If the thesis is printed on both sides of the page then 
% the second page must be must be empty. Comment this out
% if you print only to one side of the page comment this out
%\newpage
%\thispagestyle{empty}    
%\phantom{Text to fill the page}
% END OF EXTRA PAGE WITHOUT NUMBER


%===COMPULSORY INFO PAGE
\newpage

%=== Info in English
\newcommand\EngInfo{{%
\selectlanguage{english}
\noindent\textbf{\large Coverage Analysis of LPWAN in Estonia: Sigfox and NB-IoT Case study in Tallinn and Tartu}

\vspace*{3ex}

\noindent\textbf{Abstract:}

\noindent
Low Power Wide Area Networks (LPWANs) have become an important technology for the Internet of Things, as they provide radio coverage in the order of kilometers and enable battery-powered devices to operate for years.
This thesis presents the in-depth technical overview along with results of an in-field investigation of the coverage analysis of two LPWAN technologies i.e., NB-IoT and Sigfox, conducted  in  Tartu and Tallinn. The observations are taken for the time span of 12-24 hours with the evaluation boards using NB-IoT sim-cards by two commercially available NB-IoT operators (Telia and Elisa) and the single Sigfox operator in Estonia. 
Most of the existing literature on NB-IoT coverage is replete with Received Signal Strength Indicator (RSSI)-based coverage analyses. However, RSSI is most of the time not sufficient for evaluating LTE-based technologies including NB-IoT. Thus, our investigation of NB-IoT coverage considers three parameters: RSSI,Reference Signal Received Power (RSRP), and Reference Signal Received Quality (RSRQ). Sigfox, being a non-LTE technology, we base our coverage analysis only on the RSSI factor. Both technologies are evaluated in indoor, outdoor and deep-indoor/underground environments so as to provide an understanding of their coverage in various propagation and penetration conditions. Our results indicate that in outdoor scenarios, both Sigfox and NB-IoT achieve good to excellent coverage with almost 0\% packet losses. However, in indoor scenarios, few packet losses were observed in Sigfox while no packet losses were observed in NB-IoT, even with a weaker coverage, and possibly due to re-transmissions that is a salient feature of the NB-IoT making it more reliable than its competitive LPWAN technologies. However, in deep-indoor or underground scenarios, coverage outages were recorded for NB-IoT, especially in Tartu area, indicating its weaker coverage in that city.

\vspace*{1ex}

\noindent\textbf{Keywords:}\\
LPWAN, NB-IoT, Sigfox, coverage, network-testing 
%Layout, formatting, template

\vspace*{1ex}

\noindent\textbf{CERCS:} P170 Computer science, numerical analysis, systems, control
%\TODO{CERCS code and name:~\url{https://www.etis.ee/Portal/Classifiers/Details/d3717f7b-bec8-4cd9-8ea4-c89cd56ca46e}}

\vspace*{1ex}
}}%\newcommand\EngInfo


%=== Info in Estonian
\newcommand\EstInfo{{%
\selectlanguage{estonian}
\noindent\textbf{\large Sigfoxi ja NB-IoT võrgud (võrgu analüüs) Eestis: Uuring Taltechi ülikoolilinnakus ja Tartu ülikoolis, Delta ja Paabeli hoonetes}
\vspace*{1ex}

\noindent\textbf{Lühikokkuvõte:} 

%\noindent ...

Madala energiatarbega laivõrkudest (LPWAN) on saanud asjade interneti oluline tehnoloogia, kuna need pakuvad raadiosidet kilomeetrite ulatuses ja patareide mitmeaastast kestvust. See lõputöö tutvustab kahe LPWAN-tehnoloogia - NB-IoT ja Sigfoxi katvuse analüüsi ja mõõtmise tulemusi, mis viidi läbi ülikoolilinnakutes kahes Eesti suuremas linnas, s.o Tartus ja Tallinnas. Katsetes käsitleti kahte Eestis turul olevat NB-IoT operaatorit ja ühte Sigfoxi operaatorit. Enamik olemasolevast kirjandusest NB-IoT võrgu kohta on piirdub RSSI-põhise katvusanalüüsiga. Kuid RSSI pole enamasti LTE-põhiste tehnoloogiate, sealhulgas NB-IoT, hindamiseks piisav. Seega, NB-IoT leviala uurimisel võetakse arvesse kolme parameetrit: RSSI, RSRP ja RSRQ. Olukordades, kus RSSI väärtused pole saadaval, põhineb katvuse analüüs RSRP ja RSRQ väärtustel. Sigfoxi leviala puhul lähtume oma analüüsis ainult RSSI faktuuridest Sigfoxi võrgus. Mõlemat tehnoloogiat hinnatakse sise-, välitingimustes ja sügaval siseruumides / maa-aluses keskkonnas, et saada ülevaade nende võrgu katvusest erinevates tingimustes. Meie tulemused näitavad, et nii Sigfoxi kui ka NB-IoT välitingimuste stsenaariumide korral saavutatakse hea või suurepärane katvus kuni 0\% -lise paketikaotusega. Sisestsenaariumi korral täheldati Sigfoxis siiski vähe paketikadu, samas kui NB-IoT-s ei täheldatud pakettide kadusid, isegi nõrgema katvuse korral. Võimalik, et taas-edastuste tõttu, mis on NB-IoT oluline omadus, mis muudab selle töökindlamaks kui selle konkurentsivõimelised LPWAN-tehnoloogiad. Kuid sügaval siseruumides asuvate maa-aluste stsenaariumide korral registreeriti NB-IoT katvuse katkestused, eriti Tartus, mis näitab selle nõrgemat katvust selles linnas.

\vspace*{1ex}

\noindent\textbf{Võtmesõnad:}\\
LPWAN, NB-IoT, Sigfox, coverage, network-testing 
%Layout, formatting, template

\vspace*{1ex}

\noindent\textbf{CERCS:} P170 Arvutiteadus, arvanalüüs, süsteemid, kontroll
%\TODO{CERCS kood ja nimetus:~\url{https://www.etis.ee/Portal/Classifiers/Details/d3717f7b-bec8-4cd9-8ea4-c89cd56ca46e}}

\vspace*{1ex}
}}%\newcommand\EstInfo


%=== Determine the order of languages on Info page
\iflanguage{english}{\EngInfo}{\EstInfo}
\iflanguage{estonian}{\EngInfo}{\EstInfo}


\newpage
\tableofcontents
%To remove the red boxes around the hyperlinks
\hypersetup{hidelinks}
\newpage
%Table of abbreviation 
%\Large{\textbf{Terms and Notion}}
%\newpage

%List of figures and tables
\listoffigures
\listoftables
\newpage

% Remember to remove this from the final thesis version

%\listoftodos[Unsolved issues]
% END OF TODO PAGE 


\newpage
\section{Introduction}

The term Internet of Things (IoT) refers to collection of physical devices embedded with various sensors, that are connected to the Internet through IP protocols. This feature enables them to gather and exchange the value-added data with the end users. These small devices are  beneficial to wide spectrum of use-cases in transportation, e-health, smart cities, smart logistics, smart metering (electricity,gas and water) and many more \cite{basu2019experimental}, see Figure \ref{fig:IoT generic scenario}, shows how IoT devices communicate and send data to the central cloud center in IoT ecosystem. These devices send their data to Internet through wireless or Machine-to-Machine (M2M) protocols \cite{singh2015secure}. By the year 2025, it is projected 30 billion devices will be connected to network worldwide \cite{nokiaresource}; European Commission has published a study in the year 2016, that claims 6 billion IoT devices will be connected in European Union (EU) IoT market \cite{EUIoT}, and the IoT market will generate \$1 trillion euros by end of year 2020 \cite{liu2019privacy}. \par
%figure1: 
\begin{figure}[H]
  \includegraphics[width=\columnwidth,height=10cm,keepaspectratio]{Images/iot_generic_scenario.pdf}
  \centering
  \caption{IoT generic scenario}
  \label{fig:IoT generic scenario}
\end{figure}

In recent years, focus has been shifted to wireless IoT communication where Low Power Wireless Network (LPWAN) is viewed as one of the empowering influencer. According to research published by NOKIA \cite{nokiaresource}, a quarter of connected devices from the total will be connected to the Internet using the LPWAN, see Figure \ref{fig:Projected Growth of LPWAN}. Unlike to other short-range wireless IoT communication technologies like Zig-Bee \cite{zigbeeAliance}, Z-wave \cite{zwave}, Bluetooth \cite{bluetooth}, wireless local area networks W-LANs etc. LPWAN technologies have advantages since they support long coverage range, low cost of operations, long battery life (>10 Yrs) e.t.c., since LPWAN requires a low infrastructure cost for deployment and maintenance, it has fueled its momentum in recent years \cite{gomez2019sigfox}. Among the available LPWAN technologies, Sigfox, LoRaWAN, and  NB-IoT are the most prevalent and emerging technologies, with technical differences like data size, number of transmission allowed e.t.c., are preferred as per the individual application requirements.\par

%figure2: 
\begin{figure}[h!]
  \includegraphics[width=\linewidth,height=9cm]{Images/LPWAN_growth.png}
  \centering
  \caption{Projected growth of LPWAN by Nokia \cite{nokiaresource}}
  \label{fig:Projected Growth of LPWAN}
\end{figure}
\newpage

\subsection{Motivation}\label{motivation}

The promising prospects of LPWAN has encouraged the industries to adopt this technology in industrial IoT applications. \par
NB-IoT offers high Quality of Service(QOS), reliability, scalability, payload length but at the same time compromises with Sigfox in terms of coverage range, cost efficiency, network deployment and battery life \cite{mekki2019comparative}. Both these technologies holds a competitive market in Estonia but unfortunately, currently does not have uptake yet due to very minimum technological awareness among the application users. Application users demand strong network coverage before they are interested in developing business use cases, and LPWAN operators require consumers and enterprises demands or business cases before deploying and strengthening the current network. This leads to a paradoxical situation where both parties don't come to agreement. These situations can be jointly mitigated by strong understanding of the technology. These understandings don't come by the fact from great theoretical and simulations analysis, absence of empirical evidence largely contribute to general uncertainty of understanding the technology and results in slower adoption rate towards the technology. In this thesis, we give in-depth technical overview of LPWAN technology primarily; Sigfox and NB-IoT, and addition to the technical overview, the thesis involves empirical results, since most of the existing literature are replete with one parameter analysis i.e., Received Signal Strength Indicator \cite{malik2019nb,khan2019dorm} and most of time one parameter analysis is not sufficient for evaluating LTE-based technology, we further explain this in section \ref{related work}. Through this experiment we also rule out advantages, disadvantages and challenges in different deployment scenarios of NB-IoT and Sigfox. This thesis mainly addresses on three below research questions as addressed below:
%\renewcommand{\labelenumi}{\roman{enumi}}
\begin{itemize}
   \item \textbf{RQ1:} How do different LPWAN technologies (license and un-licensed) perform considering the radio parameters such as RSSI, RSRP, RSRQ, SINR, and packet loss in different deployment scenarios?
\item \textbf{RQ2:} How are these performances affected by different mobile network operators (MNO) in different locations and settings?

\item \textbf{RQ3:} What is the impact of interference caused by multiple similar devices? 
   \end{itemize}
%\end{enumerate}

\subsection{Thesis Structure}
The remainder of this thesis is divided into 4 chapters. Chapter \ref{State of the Art} presents the technology overview and the related works of LPWAN technologies - Sigfox and NB-IoT. Chapter \ref{Results and Methodology} describes the experimental setup followed with the results and finally, Chapter \ref{conclusion} concludes this thesis with future works.

\newpage
\section{State of the Art}\label{State of the Art}
This chapter provides the technological background of the LPWAN technologies in the context of this thesis. First, we present the background of LPWAN followed with comparison of all the LPWAN technologies e.g., Sigfox, LoRa, LTE-M, and NB-IoT  in the form of table. Second, we give the overview of LPWAN presence in Estonia. Third, we explain the basics of modulation in reference to modulation technique used in the Sigfox and NB-IoT. Then, we give in-depth overview of technical aspect of Sigfox and NB-IoT explaining the network topology, frame structure e.t.c., and Last, we present out the previous research contributions.

\subsection{Low Power Wide Area Network (LPWAN)}

The paradigm LPWAN has emerged in recent years, therefore not every IoT application matches LPWAN technology. LPWAN fits well to those applications which aim to have low cost of operation, long battery life , low throughput, wide area connectivity which enables devices to send tiny data over large geographical region and low power consumption so that deployed devices are operational for many years (>10 yrs). According to reports the coverage range can reach up to 5 km in urban areas and up to 15 km in rural areas \cite{centenaro2016long} and some even pointing to 30 km range in rural areas \cite{petajajarvi2016evaluation} Figure \ref{fig:LPWAN Vs Other Wireless Technologies} shows the comparison of LPWAN with other wireless technologies.


%figure3: 
\begin{figure}[H]
  \includegraphics[trim={3cm 0 4cm 0},width=\columnwidth,height=8.5cm,keepaspectratio]{Images/lpwan_radar_3.pdf}
  \centering
  \caption{LPWAN Vs Other Wireless Technologies \cite{lpwanradar}}
  \label{fig:LPWAN Vs Other Wireless Technologies}
\end{figure}

The technology is broadly classified into two categories: Licensed (e.g., NB-IoT, LTE-M-IoT) and Non licensed (e.g.,Sigfox,Telensa,LoRa, RPMA, NB-Fi, Weightless) based on frequency spectrum \cite{8612009} and further Non-Licensed are sub categorised as Ultra Narrow Band (UNB) (e.g., Sigfox) and Spread Spectrum (SS) (e.g.,LoRa) based on physical layer communication \cite{8544414}. Table \ref{table:LPWAN comparison} is extracted from \cite{LPWANspecs}, illustrates the comparison of specification among various LPWAN technologies. It can be interpreted from the table, that Sigfox and NB-IoT extends +160 dB maximum coupling loss (MCL) this indicates both these technologies support coverage in deep-indoor scenarios, this will be one of the scope of observation in this thesis. \par

% Please add the following required packages to your document preamble:
% \usepackage[table,xcdraw]{xcolor}
% If you use beamer only pass "xcolor=table" option, i.e. \documentclass[xcolor=table]{beamer}
\begin{table}[H]
\caption{Technical specification comparison of LPWAN technologies \cite{LPWANspecs}}
\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|c|c|c|c|}
\hline

Feature                                & Sigfox UNB      & LoRa            & LTE-M              & NB-IoT               \\ \hline
\textbf{Frequency}                     & Sub-GHz ISM     & Sub-GHz ISM     & Licensed           & Licensed             \\ \hline
\textbf{Minimum Bandwidth}             & 100 Hz or 600Hz & 125 kHz         & 180 kHz            & 3.75 kHz             \\ \hline
\textbf{Effective Bandwidth}           & 300 Hz          & 3 khz           & 10 kHz             & 3 khz                \\ \hline
\textbf{Data Rate}                     & 100 bps         & 0.3-38.4 kbps   & Up to 1000kbps     & Up to 100 kbps       \\ \hline
\textbf{Modulation}                    & D-BPSK          & CSS, GFSK       & BPSK, QPSK, 16 QAM & $\pi$/2-BPSK, $\pi$/4-QPSK \\ \hline
\textbf{Media Access Control (MAC)}    & Unslotted ALOHA & Unslotted ALOHA & SC-FDMA            & SC-FDMA              \\ \hline
\textbf{Receiver Senstivity}           & -147dBM         & -137 dBm        & 23 dBm             & -137 dBm             \\ \hline
\textbf{Default Transmitted Power}     & 15 dBm          & 20 dBm          & 23 dBm             & 23 dBm               \\ \hline
\textbf{Maximum Coupling Loss}         & 162 dB          & 157 dB          & 155 dB             & 160 dB               \\ \hline
\textbf{Bi- Directional Communication} & No              & Yes             & Yes                & Yes                  \\ \hline
\textbf{Over the Air Update (OTA)}     & Yes             & Yes             & Yes                & Yes                  \\ \hline
\textbf{Roaming}                       & Yes             & Yes             & Yes                & Yes                  \\ \hline
\textbf{Standard}                      & No              & LoRaWAN         & LTE (Release 12)   & LTE (Release 13)     \\ \hline
\end{tabular}}

\label{table:LPWAN comparison}
\end{table}

% Overview of LPWAN in Estonia
\subsection{Overview of LPWAN Technologies Across Estonia} \label{Overview of LPWAN in Estonia}

There are four main public LPWAN service providers in Estonia i.e. Telia Eesti AS, Elisa Eesti AS, Connected Baltics OÜ, and Levikom Eesti OÜ; each providing a different LPWAN technology across Estonia. Telia and Elisa operate the NB-IoT technology and cover around 90\% of the whole territory of Estonia by providing service to the entire population of Estonia. This covered geography is indicated by the large shaded ellipsoid in Figure \ref{fig:Overview of coverage of NB-IoT and Sigfox in Estonia}. Connected Baltics is the exclusive Sigfox operator in Estonia and covers the major cities of Estonia: Tallinn, Tartu, Pärnu and Narva by covering around 70\% of the Estonian population \cite{connected}. The geographic coverage of Sigfox across the major cities of Estonia from the Connected Baltics is indicated by small heated circles (red, blue and green) as shown in Figure \ref{fig:Overview of coverage of NB-IoT and Sigfox in Estonia} (\cite{connected}). LEVIKOM \cite{levikom} provides LoRaWAN services but no details about their coverage in Estonia and thus we have omitted showing their coverage in Figure \ref{fig:Overview of coverage of NB-IoT and Sigfox in Estonia}. \par \begin{figure}[H]
    \centering
    \includegraphics[width=0.9\columnwidth,height=7cm, keepaspectratio]{Images/coverage.pdf}
    \caption{Sigfox (red, blue, green smaller circles) and NB-IoT (large shaded ellipsoid) coverage in Estonia}
    \label{fig:Overview of coverage of NB-IoT and Sigfox in Estonia}
\end{figure}


%Modulation techniques in LPWAN

\subsection{Fundamentals of Modulation in LPWAN}

\begin{comment}
In this section, we will briefly discuss the different modulations techniques and will cover the popular modulation techniques used in Sigfox and NB-IoT which is mainly focused in this thesis.
\end{comment}

%\subsubsection{Fundamentals of Modulation}
Modulation is a process of changing the characteristics of the carrier wave that needs to be transmitted by impressing the message signal with the high frequency. There are three main characteristics of every wave by which modulation can be achieved: frequency, amplitude and phase. Frequency in waveform refers to how many times the wave has repeated in given interval of time, Amplitude refers to the power or the strength of wave and phase refers to state of wave in particular point in time. The main objective of the modulation in telecommunication is to squeeze as much data in spectrum available. As discussed in \cite{raza2017low} LPWAN achieves long range communication by a modulating the signal with high data rate and decreasing the modulation rate in order to put more energy on each transmitted bit. The rate is measured in bits per seconds per Hz (b/s/Hz). The two basic types of modulations used more often are discussed in below sub-sections.
%\begin{enumerate}
    \subsubsection{Analog Modulation} 
    Analog modulation refers to the modulation of analog signals and they are further categorised into:
    
    \renewcommand{\labelenumi}{\roman{enumi}}
    \begin{enumerate}
        \item Amplitude Modulation: In amplitude modulation the amplitude of the carrier wave is changed according to the signal wave. The modulating wave as a result achieves high frequency.Figure \ref{Fig:Amplitude Modulation}, signal wave that need to be transmitted is shown on top. In the middle is the carrier wave to which signal wave will be super imposed and the last one is the result.
       
% -----fig amplitude modultaion----
 \begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/signalWave.pdf}  
  \caption{Signal Wave}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/carrierWave.pdf}  
  \caption{Carrier Wave}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/AMwave.pdf}  
\caption{Amplitude Modulated Wave}
 \end{subfigure}
\caption{Amplitude Modulation}
 \label{Fig:Amplitude Modulation}
\end{figure}

% -----fig amplitude modultaion ends here----


         \item Frequency Modulation: In frequency modulation frequency of carrier wave is changed according to signal wave and this changed carrier wave is super imposed with the signal.The result is with signal with variable frequency. On Figure \ref{fig:Frequency Modulation}, signal wave that need to be transmitted is shown on top. In the middle is the carrier wave to which signal wave will be super imposed and the last one is the result.
        
           %----figure fm modulation--- 
         \begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/signalWave.pdf}  
  \caption{Signal Wave}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/carrierWave.pdf}  
  \caption{Carrier Wave}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/FMwave.pdf}  
\caption{Frequency Modulated Wave}
 \end{subfigure}
\caption{Frequency Modulation}
 \label{fig:Frequency Modulation}
\end{figure}
        %----figure fm modulation ends here--- 
        
        


\item Phase Modulation: It is mainly intended for transmitting communication signals where amplitude of signal is changed in accordance with the carrier wave due to differences in immediate phase.
\begin{figure}[H]
    \centering
    \includegraphics[width=.5\linewidth]{Images/PMmodulation.pdf}
    \caption{Phase Modulation}
    \label{fig:Phase Modulation}
\end{figure}
    \end{enumerate}
    
    The above modulations are mainly used for analog signals that are raw data and they do not represent 0's and 1's. For such digital data we use digital modulations.
    \subsubsection{ Digital Modulation} In case of digital data change in amplitude, phase, or frequency is represented by the help of 0's and 1's and therefore it is sub-divided into to three modulations schemes i.e., amplitude shift keying (ASK), phase shift keying (FSK), and frequency shift keying (FSK). Figure \ref{fig:Digital Modulation} illustrates FSK, PSK, and ASK for the bit sequence 1010.
   
   %---fig digital modulation begins----
   \begin{figure}[H]
       \centering
       \includegraphics[width=0.5 \columnwidth]{Images/digitalModulation.pdf}
       \caption{Digital modulation}
       \label{fig:Digital Modulation}
   \end{figure}
 %\end{enumerate}
 
  Sigfox uses Differential Binary Phase Shift Keying (D-BPSK) modulation in uplink and Gaussian Frequency Shift Keying (GFSK) in downlink communication. D-BPSK is a powerful modulation used by base stations or gateways to convert the incoming signal from devices, debug it, and send it back to the cloud. It takes only 1 Hz of the operation band to transmit 1 bit/s, this reduces the possibility of invalid translations and gives more time to demodulate, large link budget and high receiver sensitivity for the base stations; for 100 bps, sensitivity of base station is -142 dBM and at 600 bps it is -134 dBM. Furthermore, since the range of the signal weakens over distance, having only two states enhances the range and gives robustness to the signal \cite{gaddam2018comparative}.
 
  %----- fig QPSK constellation graph---
  \begin{figure}[H]
      \centering
      \includegraphics[width=0.5 \columnwidth, height=5cm, keepaspectratio
      ]{Images/QPSK.pdf}
      \caption{QPSK constellation graph}
      \label{fig:QPSK constellation graph}
  \end{figure}
    %----- fig QPSK constellation graph ends here ---
  NB-IoT uses both Binary Phase Shift Keying (BPSK) and Quadrature Phase Shift Keying (QPSK) for uplink and downlink, respectively. In BPSK, there are two phases 0$^{\circ}$ and 180$^{\circ}$ to transmit 1 and 0 states, and they are often transmitted by modulating the phase of the carrier wave at 1 bit per symbol whereas, QPSK, has two bits per symbol therefore for two bits we need four phases (45$^{\circ}$, 135$^{\circ}$, 225$^{\circ}$, and 315$^{\circ}$) each phase has a separation of 90$^{\circ}$ with four possible combination i.e., 00, 01, 10, 11. Figure \ref{fig:QPSK constellation graph}, represent the constellation graph of Quadrature Phase Shift Keying (QPSK). The phase of the signal is denoted by angle formed with `I' axis, `Q' axis denotes the amplitude of signal and four possible combinations 00, 01, 10 and 11 are referred as data points.
  
  \begin{comment}
  with respect to the reference  signal, a cosine wave correlates to 1, whereas sine wave correlates to 0 in BPSK.
  \end{comment}
   
 
 To summarise everything above, almost every LPWAN technologies reduces their modulation rates to maintain high energy of each transmitted bit. By doing this, the base stations are able to translate even the weakest signals without any errors.


\subsection{Overview of Sigfox}\label{sigfox technical}
\subsubsection{Introduction}
The technology was founded in 2009 in France in a city Toulouse which is also known as IoT valley of France. At the time of writing this thesis Sigfox is spread in 70 countries \cite{SigfoxCoverage} and it is operating in collaborations with different operators in these countries. It is claimed by Sigfox, it will complete WAN coverage in partnership with Eutelsat by sending constellation of nano-satellites by end of year 2020, this will enhance their global coverage \cite{SigfoxSatellite}. Sigfox is considered to be one of the cheapest solution among all LPWAN technologies \cite{hernandez2017energy} which gives them advantage over their competitors in LPWAN ecosystem. 

 \subsubsection{Technology}
As far as technology is concerned Sigfox operates in ISM and Short-Range Devices (SRD860) bands worldwide from 862 to 928 MHz. To be precise it utilizes 192kHz of SRD860 to deliver the messages using the Ultra Narrow Band Modulation (UNB). Radio configuration are divided geographically into RC zone. Table \ref{table:SigfoxRCZone} shows the radio frequencies distribution of Sigfox worldwide.

% Please add the following required packages to your document preamble:
% \usepackage[table,xcdraw]{xcolor}
% If you use beamer only pass "xcolor=table" option, i.e. \documentclass[xcolor=table]{beamer}
\begin{table}[H]
\caption{Radio Frequency distribution of Sigfox worldwide \cite{SigfoxRCZone}}
\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|c|c|c|}
\hline

                         & \begin{tabular}[c]{@{}c@{}}Zone 1\\ EMEA\end{tabular} & \begin{tabular}[c]{@{}c@{}}Zone 2\\ AMERICAS/APAC 1\end{tabular} & \begin{tabular}[c]{@{}c@{}}Zone 3\\ APAC 2 (JAPAN,South Korea)\end{tabular} \\ \hline
\textbf{Frequency (MHz)} & 862-876                                                & \multicolumn{2}{c|}{902-928}                                                                                                                   \\ \hline
\textbf{RC}              & RC1                                                    & RC2,4                                                            & RC3a,RC3c,RC5                                                               \\ \hline
    \end{tabular}}

\label{table:SigfoxRCZone}
\end{table}

\paragraph{Ultra-Narrow Band}

Ultra Narrow Band employs an ultra-narrow spectrum channel (<1KHz) to provide higher sensitivity and ultra-long distance connectivity between transmitter and receiver at the expense of maximum throughput data rates 100 bps \cite{raza2017low,bardyn2016iot,mekki2019comparative}. The demodulated spectrum is much wider than the individual transmission so that multiple devices can send message simultaneously consuming low power thus enabling the devices to have long battery life. Addition to this it offers a very good link budget due to the concentration of power in a narrow frequency band thus filtering most of the noise \cite{naik2018lpwan,7417420}, enabling the Sigfox base stations to communicate over long distances without being impacted by the noise \cite{SigfoxTechnicalDoc} Figure \ref{fig:Sigfox Technology based on UNB} depicts distribution of Sigfox in UNB. Also, UNB decreases the device's cost due to simpler and cost effective transceivers \cite{roth2018physical}.

\begin{figure}[H]
  \includegraphics[width=\textwidth]{Images/sigfox_unb.png}
  \centering
  \caption{Sigfox technology based on Ultra-Narrow Band  \cite{SigfoxTechnicalDoc}.}
  \label{fig:Sigfox Technology based on UNB}
\end{figure}

Aforementioned, Sigfox is bi-directional technology there are two terminologies involved uplink and downlink; uplink, refers to communications from an end device to a network server or application via one or more gateways; Downlink, refers to communications from a network server or application via one gateway to a single end device or a group of end devices \cite{farrell2018low}. Sigfox uses Differential Binary-Shift Keying (D-BPSK) for uplink transmission and Gaussian Frequency-Shift Keying (GFSK) in case of downlink transmission, the role of DPSK modulation is to alleviate the problem of interference introduced while the message is over-the-air (OTA) from the device and ensure that signal that left the base station is exact signal sent by device; the base station hardware achieves this by shifting the signal phase. Sigfox uses D-BPSK over GFSK in uplink, due to the fact, D-BPSK is more bandwidth efficient than GFSK, which means it has fewer frequencies and channels available to transmit the signal; fewer transmit signal corresponds to lower data rate and throughput and lower data rate means high receiver sensitivity which leads to higher coverage  \cite{explainingSigfox}. Downlink messages are limited in Sigfox protocol, and therefore there is a asymmetry; downlink message is sent only when device has made a downlink request in the uplink, Figure \ref{Fig:Sigfox frame structure} illustrates Sigfox uplink and downlink frame structure and Table \ref{sigfoxplan} describes the limitations and payload offerings across various subscription plans.

\begin{figure}[h]
\begin{subfigure}[t]{\columnwidth}
  \centering
  % include first image
  \includegraphics[width=.8\columnwidth]{Images/SigfoxUplinkFrame.pdf}  \caption{Sigfox uplink frame structure }
\end{subfigure}

\begin{subfigure}[t]{\columnwidth}
  \centering
  % include second image
  \includegraphics[width=0.8\columnwidth]{Images/SigfoxDownlinkFrame.pdf}  
  \caption{Sigfox downlink frame structure}
\end{subfigure}

\caption{Sigfox frame structure, adapted from \cite{gomez2019sigfox,farrell2018low}}
\label{Fig:Sigfox frame structure}
\end{figure}


\begin{table}[]
\caption{Sigfox offerings and limitations across it's subscription plans \cite{finnegan2018analysis}}
\centering
\resizebox{0.8\columnwidth}{!}{%
\begin{tabular}{|c|c|c|}
\hline
Plan     & Number of messages        & Max. bytes per day \\ \hline
Platinum & 140 uplinks + 4 downlinks & 1680               \\ \hline
Gold     & 100 uplinks + 2 downlinks & 1200               \\ \hline
Silver   & 50 uplinks + 1 downlink   & 600                \\ \hline
One      & 2 uplinks + no downlink   & 24                 \\ \hline
\end{tabular}%
}

\label{sigfoxplan}
\end{table}

\paragraph{Duty cycle \& Sleep Mode}
As per European Telecommunications Standards Institute (ETSI) regulations, there are restrictions imposed to the unlicensed frequencies in terms of payload transmission, according to it, Sigfox can utilize 1\% of sub-band in the 868 MHz EU ISM band \cite{etsi2012electromagnetic} allowing it to send maximum 140 uplink and 4 downlinks messages consisting of 12 bytes and 8 bytes of maximum payload length, respectively. Therefore, this concludes Sigfox device may only transmit 36 seconds per hour. The time on air is ~6 sec per package, which equals maximum 6 messages in 1 hour \cite{vejlgaard2017coverage,SigfoxTechnicalDoc,securitysigfoxwhitepaper}. This argument also hold valid for Sigfox that for every uplink message, there cannot be downlink message as acknowledgement. Figure \ref{fig:ETSI duty Cycle and Power restriction} illustrates the duty cycle and power restriction by ETSI for various un-licensed frequencies.\par


%duty-cycle defined by ETSI
\begin{figure}[H]
  \includegraphics[width=\textwidth]{Images/duty_cycleLPWAN.png}
  \centering
  \caption{868 MHz ISM EU power and duty cycle restriction  \cite{etsi2012electromagnetic}.}
  \label{fig:ETSI duty Cycle and Power restriction}
\end{figure}

However, not able to use the channel 99\% of the time allows the device to be in deep sleep most of the time which enables them to save lot of battery and cost which in return leads to long operation (>10Yrs), see Figure \ref{fig:Idle-Active states in Sigfox}.
\begin{figure}[H]
\centering
  \includegraphics[width=\columnwidth, height=7cm, keepaspectratio]{Images/ActiveSleepSigfox.pdf}
  \centering
  \caption{Idle-Active states in Sigfox  \cite{SigfoxTechnicalDoc}.}
  \label{fig:Idle-Active states in Sigfox}
\end{figure}

\paragraph{Frequency and Time Diversity}
To overcome the packet loss and acknowledgement for each transmitter message Sigfox uses frequency and time diversity technique where each time the device has payload to send it transmits at three subsequent frequencies at three different slots as shown in Figure \ref{fig:Frequency and Time Diversity}.

\begin{figure}[H]
\centering
  \includegraphics[width=\columnwidth]{Images/frequency_time_diversity.pdf}
  \centering
  \caption{Frequency and Time Diversity  \cite{SigfoxTechnicalDoc}}
  \label{fig:Frequency and Time Diversity}
\end{figure}

\paragraph{Spatial Diversity in Sigfox}
Spatial diversity in Sigfox defines that devices are never associated to the base stations.The emitted message is received by any near by base station and on a average the number of base station receiving the message is 3 \cite{SigfoxTechnicalDoc}. Fig \ref{fig:Spatial Diversity in Sigfox} illustrates the spatial diversity in Sigfox.

%---fig sigfox spatial diversity----
\begin{figure}[H]
  \includegraphics[width=0.5 \columnwidth, height=5cm,keepaspectratio]{Images/spatial_diversity.pdf}
  \centering
  \caption{Spatial Diversity in Sigfox, adapted from \cite{SigfoxTechnicalDoc}}
  \label{fig:Spatial Diversity in Sigfox}
\end{figure}
%---fig sigfox spatial diversity ends----


\subsubsection{Network Architecture}\label{Network Architecture}

Sigfox architecture comprises of devices, base stations and Sigfox core network. Devices transmit their data by sending it to the nearest base stations. In this scenario, a device is not associated to the particular base station, therefore at the time of communication the device transmits it's data at three different frequencies which is received by the nearest base station; upon receiving the message, the base station transfers the message to the Sigfox support system, which consists of the Sigfox cloud and other backend services. This approach avoids handover procedures to support device mobility.


\begin{figure}[H]
  \includegraphics[width=\textwidth]{Images/sigfox_architecture.pdf}
  \centering
  \caption{Sigfox Network Architecture, adapted from \cite{SigfoxTechnicalDoc}}
  \label{fig:Sigfox Network Architecture}
\end{figure}


The back-end takes care of message processing, there can be scenario where potentially lots of replicates of the same message arrives at back-end; Sigfox cloud manages these replicas and stores one entry. The core network is composed of the Service Center and the Registration Authority. The service center controls and manages the base stations and the devices whereas, registration authority is responsible for authorizing the network access of devices; it also monitors the status of the network and manages the base stations globally. Finally, the web interface and the API allow customers to interact and access their data with the Sigfox. As aforementioned, Sigfox does not allow acknowledgement therefore Sigfox back-end is the only platform to validate the success of message received by base station  \cite{SigfoxTechnicalDoc,gomez2019sigfox}, see Figure \ref{fig:Device's message history at Sigfox backend} which illustrates the message history of device 1B28FA5 that consist timestamps, latency of message, data, signal quality and location of device.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\columnwidth]{Images/sigfoxHistory.pdf}
    \caption{Message history of device at Sigfox backend}
    \label{fig:Device's message history at Sigfox backend}
\end{figure}



\subsubsection{Security}\label{Sigfox Security}
Security is one of the main challenging issue of IoT since security of single business application is not enough. With the IoT, multiple applications across multiple industries communicate and exchange data across different networks, transmitted data from the devices must have a certain security fundamentals such as integrity, confidentiality, and authentication to avoid fatal and catastrophic security attacks, and  all this should be addressed holistically.\par


%---commented Sigfox security figure, not using---
\begin{comment}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\columnwidth]{Images/sigfoxSecurity.pdf}
    \caption{Sigfox security schematics \cite{securitysigfoxwhitepaper}}
    \label{fig:Sigfox security schematics}
\end{figure}
\end{comment}
%---commented Sigfox security figure, not using---


Sigfox applies several layers of security this encompasses the complete IoT chain including devices, network infrastructure, and cloud-based services which covers the device layer to the application layer, as can be seen in Sigfox architecture in Figure \ref{fig:Sigfox Network Architecture}. Since, Sigfox devices are not directly connected to the internet protocol (TCP/IP), they have built-in-firewall mechanism that protects itself from denial-of-service-attacks (DDoS) and device cloning \cite{securitysigfoxwhitepaper}. In order to secure device transmission and communication with the Sigfox cloud, a Sigfox device is most of the time in deep-sleep mode, this makes the device immune to any possible hackers and eavesdroppers;  data is transmitted to or received from the internet has unique authentication key, using this unique key, the device broadcasts it's radio message creating unique signature for each message. In order to prevent duplication of message the device also adds a sequence number in the message frame. This message is picked up by several base stations and is forwarded to the Sigfox core network, which delivers it to a predefined destination, typically an IoT application. If the Sigfox device requires a response, a small limited time window is open to deliver the response to the device through the Sigfox core network. Thus, this design safeguards Sigfox devices, the ability to send arbitrary data entities via internet through very strict built-in-firewall \cite{SigfoxTechnicalDoc,securitysigfoxwhitepaper}.
%---end of sigfox security----------


\subsection{Overview of NB-IoT}\label{Overview of NB-IoT}

\subsubsection{Introduction}
Narrow Band IoT (NB-IoT) is a licensed LPWAN narrow band radio technology and is a extention of long-term evolution (LTE) which is designed specifically for IoT. It was developed as part of 3rd Generation Partnership Project (3GPP) project in June, 2016. The journey began in May, 2014 when Huawei and Vodafone proposed Narrowband Machine to Machine (NB-M2M) to 3GPP as a part of the study to cope the demands of LPWAN market; new telecom industrial players like Qualcomm also became interested, and in same year they proposed Narrowband Orthogonal Frequency Division Multiplexing (NB-OFDM) and with the result of this, in May 2015, 3GPP incorporated two proposals (i.e., NB-M2M and NB-OFDM) and formed the Narrowband Cellular IoT (NB-CIoT). In September 2015, 3GPP merged all the proposals as a work item for Release 13 which resulted in formation and recognization of NB-IoT. Since then, many telecommunication players like Ericsson, Nokia, Intel and Huwaei have been active part of standardization process \cite{malik2018radio,5GUK,mwakwata2019narrowband}.


\subsubsection{Technology}\label{NB-IoT Technology}
\paragraph{Low Channel Bandwidth}

Like LTE, NB-IoT is based on orthogonal frequency-division multiple access (OFDMA) that occupies frequency bandwidth with 180 kHz system bandwidth, which corresponds to one physical resource block (PRB) in LTE transmission. With 180 kHz of minimum spectrum requirement, NB-IoT can be deployed in three possible operational modes, i.e., i) as standalone, ii) in the guard carriers of existing LTE/UMTS spectrum, iii) within an existing LTE carrier (inband) by replacing one or more PRBs, see Figure \ref{fig:NB-IoT operational modes}. In order to support such flexible deployment scenarios, NB-IoT reuses the LTE design extensively, such as OFDM in downlink and single carrier frequency-division multiple access (SC-FDMA) in uplink \cite{8612009,malik2018radio,sinha2017survey,boisguene2017survey}. All three operational modes are only deployed  in licensed frequency bands. The maximum transmission power is either 20 or 23 dBm for uplink transmissions, while for downlink transmission, the base station may have higher transmission power, up to 46 dBm depending on the deployment \cite{farrell2018low}.\par
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\columnwidth, height=5cm, keepaspectratio]{Images/nbiotModes.pdf}
    \caption{NB-IoT operational modes, adapted from \cite{xu2017narrowband,mekki2019comparative}}
    \label{fig:NB-IoT operational modes}
\end{figure}
%---end of the NB-IoT operational mode----
The three operational modes are briefly explained below:
\renewcommand{\labelenumi}{\roman{enumi}}
\begin{enumerate}
    \item \textbf{In-Band Operation Mode}\newline
    In-band deployment means that the narrowband is deployed inside the LTE band and radio resources are flexibly shared between NB-IoT and normal LTE carrier \cite{farrell2018low}.
    \item  \textbf{Guard Band Operation Mode}\newline
    In Guard band deployment, the narrowband uses the unused resource blocks between two adjacent LTE carriers \cite{farrell2018low}.
    \item \textbf{Stand Alone Operation Mode}\newline
    Standalone deployment is also supported, where the narrowband can be located alone in dedicated spectrum, which makes it possible, for example, to reframe a GSM carrier at 850/900 MHz for NB-IoT \cite{farrell2018low}.
\end{enumerate}

\paragraph{Resource grid of NB-IoT} \label{repetition}
NB-IoT only uses 180 kHz bandwidth for both uplink and downlink, and supports two modes in uplink i.e., 3.75 kHz, and 15 kHz; for downlink it has only 15 kHz spacing. In order to serve many devices it supports two schemes 1) optional multi-tone transmission and 2) mandatory single-tone transmission \cite{xu2017narrowband,malik2018radio}. Uplink, can be either single-tone or multi-tone. The 3.75kHz spacing is single-tone, and 15 kHz frequency can be utilized for both single and multi-tone. The detailed frame structure of both downlink and uplink with control channels from TR45.820 \cite{malik2018radio,TR45.820}, are as follows:

\subparagraph{Downlink Transmission:}
The frame structure of NB-IoT downlink is similar to conventional LTE, in the short time frequency of 10 ms, each frame holds 10 sub-frames of 1 ms length and each sub-frame holds two slots with the length of seven OFDMs. In frequency domain it holds one physical resource block (PRB) with 12 sub-carriers each having 15 kHz of spacing and normal cyclic prefix (CP). One symbol x one sub-carrier equals to one resource element (RE), the smallest transmission unit. RE in general is equivalent to one modulation symbol of sub-carrier i.e., 2 bits of QPSK, 4 bits of 16-QAM , and 6 bits of 64-QAM. Additionally, unlike LTE, the NB-IoT downlink physical channels and signals are primarily multiplexed in time \cite{malik2018radio}. These two physical signals and three physical channels are discussed below that are taken from  \cite{malik2018radio,ratasuk2016overview}:
%---- downlink Frame Structure----

\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\columnwidth,keepaspectratio]{Images/nbiotDownlinkFrame.pdf}
    \caption{NB-IoT downlink frame structure \cite{malik2018radio}}
    \label{fig:NB-IoT downlink frame structure}
\end{figure}
\renewcommand{\labelenumi}{\roman{enumi}}
\begin{enumerate}

    \item \textbf {Narrowband reference signal (NRS):} 
    It is used to provide phase reference at the time of demodulation of downlink channel. NRS is transmitted in all sub-frames that might be used to broadcast or downlink transmission using eight REs per antenna port. In case of in-band operation, LTE's reference signals (CRS) are also transmitted with the NB-IoT band, which is not the case in standalone and guard band operations.

    \item \textbf{ Narrowband primary and secondary synchronization signals (NPSS and NSSS):}
    NPSS transmits 5 sub-frames every 10 ms, whereas NSSS transmits 9 sub-frames periodically; these signals are used for cell search using time and frequency synchronization and cell identity detection.
    
    \item \textbf{Narrowband physical broadcast channel (NPBCH):} It stores the master information block (MIB) and it is transmitted in every sub-frame 0. In whole duration of transmission MIB is remains constant for 640 ms transmission time interval (TTI).
    
    \item \textbf{Narrowband physical downlink control channel (NPDCCH):} It is considered to be the core element of the downlink as it holds control informations like paging, random access channel (RACH) response, type of modulation being used for transmission, power control, and so on. Addition to this, it controls the data transmission between the device and the base stations (BS). The size of the control information is 23 bits which is fixed in all scenarios.
    
    \item \textbf{Narrowband physical downlink shared channel (NPDSCH)} It is considered to be main data bearing channel; holds user unicast data, some control information and the system information block (SIB). If SIB occupies the frame, it usually occupies the subframe 4 in the 16 continuous frames \cite{malik2018radio}.
 \end{enumerate}

 \subparagraph{Uplink Transmission:} As aforementioned, in NB-IoT, uplink supports both single-tone and multi-tone transmission. Multi-tone uses 15 KHz sub carrier spacing with SC-FDMA scheme and total 180 KHz bandwidth with 0.5 ms slot and 1 ms sub-frame similar to LTE. However, single-tone uses both 15 kHz and 3.75 kHz sub-carrier spacing and is four times longer compared to 15 kHz with slot length of 2 ms. Each 2 ms slot contains 7 OFDM symbols with 48 sub carriers. Addition to this, in NB-IoT there is resource mapping unit (RU) which is combination of total sub-carriers (frequency domain) and number of slots (time domain). In uplink, we have two physical channels, and one physical signal as explained below, Figure \ref{fig:NB-IoT uplink frame structure} refers to uplink frame structure of NB-IoT.
 
 \begin{figure}[H]
     \centering
     \includegraphics[width=0.9\columnwidth,height=9cm, keepaspectratio]{Images/nbiotUplinkFrame.pdf}
     \caption{NB-IoT uplink frame structure \cite{malik2018radio}}
     \label{fig:NB-IoT uplink frame structure}
 \end{figure}
 
 \begin{enumerate}
     \item \textbf{Demodulation Reference Signal (DMRS):} DMRS is multiplexed with uplink data therefore it is only transmitted in RUs.
     \item \textbf{Narrow Physical Random Access Channel (NPRACH):} It helps devices to connect to the base stations. The base station estimates the uplink timings by taking help of random access preamble which is sent by user terminal, it is necessary to issue a timing advance command just to maintain uplink orthogonality among various users.  
     \item \textbf{Narrow Uplink Shared Channel (NPUSCH):} 
     
      Unlike LTE, both the data and control information are carried over the uplink shared channel in 10 RU block size. This channel co-exist with two formats; Format 1, is used for carrying uplink data and uses turbo code for error correction. Format 2, is used for hybrid automatic repeat request (HARQ) acknowledgment for downlink data with maximum 128 repetitions \cite{malik2018radio}.
    
 \end{enumerate}
 
\paragraph{Power saving mechanism}
In order to extend the battery life of NB-IoT devices up to 10 years, 3GPP adopts two features Power Saving Mode (PSM) and Extended Discontinuous Reception (eDRx) , see Figure \ref{fig:Power saving in NB-IoT}.\par

eDRX, is a mechanism that enables device to turn-off part of it's circuitry to save power \cite{el2018evaluating}; the eDRX cycle can last up to 3 hours \cite{farrell2018low} and during this cycle the device can listen to the downlink control channel for downlink messages, also known as by term  $Narrowband\  Physical\  Downlink\  Channel\  (NPD-CCH)$. This listening process is referred as paging \cite{sultania2019implementation}.\par 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\columnwidth]{Images/nbiotDRXcycle.pdf}
    \caption{Power saving in NB-IoT \cite{sultania2019implementation} }
    \label{fig:Power saving in NB-IoT}
\end{figure}

PSM, is a mechanism which enables the device to go in a deep sleep state by turning-off it's radio up to maximum 413 days \cite{sultania2019implementation}; and wake up only for uplink transmission. In order to update the network about it's availability, the device performs periodic tracking area updates (TAU) after a configurable TAU timer has expires. The device then remains reachable and connected for paging during the paging time window (PTW) which is configurable; once the PTW expires, it again enters into  deep sleep mode (PSM mode) and becomes dormant and unreachable until the next periodic TAU occurs. During PSM mode, the device switches off its circuitry yet is still registered to the network. The advantage of such an approach lies in the fact that the device can wake up immediately from PSM mode without having to re-establish the network and Packet Data Network (PDN) connections. This prevents extra power consumption due to additional signaling messages transmission. PSM feature also maximizes the downtime of the device, which significantly reduces battery consumption \cite{rohdepowernbiot}.\par
%--end _-------

\paragraph{Coverage Enhancement}
As per 3GPP release 13, NB-IoT offers 164 dB of maximum coupling loss (MCL) coverage with a potential to add 50K devices per cell and also has ability to scale up by just adding more NB-IoT carriers, which gives ten times coverage enhancement to indoor and deep indoor scenarios compared to GPRS \cite{farrell2018low,3GPP,raza2017low}. In order to achieve +20 dB coverage extension, repetition is the main solution in given bandwidth. NB-IoT offers maximum 128 and 2048 re-transmissions in uplink and downlink, respectively \cite{bao2018coverage,mwakwata2019narrowband}. In the experiment, conducted in Tallinn University of Technology by author \cite{malik2019nb}; a total of 20 nodes were deployed in different locations and scenarios, study concluded with the claim of +20 dB extension with a real-time coverage of 700m in urban scenario. However in \cite{mekki2019comparative}, author claims that NB-IoT is not suitable technology when it comes to rural deployment due to it's lowest range and coverage capabilities (i.e., range <10 km).

\subsubsection{Network Architecture}

A basic architecture of NB-IoT is shown in Figure \ref{fig:NB-IoT Architecture} and NB-IoT is divided into three main parts:


\renewcommand{\labelenumi}{\roman{enumi}}
\begin{enumerate}

    \item End Devices or User Equipment (UE): These devices benefit the IoT application by sending the valuable data to the customer platforms. They are connected through the NB-IoT network using narrow band sim-cards from telecom operators.
    \item Base stations: These base stations are usually owned and managed by local telecom operators and base stations are often referred as eNodeB or eNB.
    \item NB-IoT core network: It provides the interface between the NB-IoT base stations and NB-IoT cloud. NB-IoT uses the same network architecture as conventional LTE network; similar to LTE, NB-IoT core network depends on the evolved-packet-system (EPS) and two optimizations for cellular IoT (CIoT), discussed below.
\end{enumerate}
%--fig nb-iot acrhitecture---
\begin{figure}[H]
    \centering
    \includegraphics[width=\columnwidth, height=7cm, keepaspectratio]{Images/nb-iotArchitecture.pdf}
    \caption{Architecture of NB-IoT, adapted from \cite{jaber2019study}}
    \label{fig:NB-IoT Architecture}
\end{figure}
%--fig nb-iot acrhitecture---

\paragraph{$Control\ Plane\ CIoT\ Optimization$}

This optimization adopts the control plane to transmit device's data packets. In order to do that, the data packets are encapsulated, and then transmitted in Non Access Stratum (NAS) signaling messages to the Mobility Management Entity (MME).
Since control plane manages to send data packets, the transmission or reception of messages is sent as NAS signaling messages between the device and MME. Compared to conventional Scheduling Requests (SR) procedure, the device avoids Access Strum (AS) security setup and user plane bearers establishment required in each data transfer. Hence, it is more suitable for short data transactions.
After the device has transmitted the uplink data, the NAS signaling message encapsulates the data packet that includes Release Assistance Information (RAI) field. This RAI filed holds the additional data for MME to further notify the incoming uplink or downlink data. In such cases, the MME can immediately trigger the S1 Release procedure (unless user plane bearers between eNB and Serving Gateway (SGW) are established). Therefore, the RAI field enables the MME to reduce the period, the device is in DRX waiting for possible additional transmissions. It is to note, control panel does not currently allow the application servers to notify the MME if no further data transmissions are expected \cite{andres2017narrowband}.\par

\paragraph{$User\  plane\  CIoT\  optimization$} \label{RRC}
User plane (UP) optimization is a alternative data transmission procedure. It requires an initial Radio Resource Control (RRC) connection to be established that configures the radio bearers and the AS security context between network and device. After this, UP enables the RRC connection to be suspended and resumed by means of two new control procedures: Connection Suspend and Resume.\par
As device moves to RRC idle state, the connection suspend procedure enables to retain device's context at eNB, and MME. Later, at the time of new message, the device is able to resume connection without sending the initial overheads. To resume the RRC connection, the device provides a Resume ID to the eNB to query the last stored context. By means of storing the context, the device avoids AS security setup and RRC re-configuration in each data transmission, compared to conventional SR procedure \cite{farrell2018low,andres2017narrowband,popli2018survey}, see Figure \ref{fig:Sequence diagram of RRC resume cycle}.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\columnwidth]{Images/dataRRCresume.pdf}
    \caption{Data transmission in RRC resume operation \cite{ratasuk2016overview}}
    \label{fig:Sequence diagram of RRC resume cycle}
\end{figure}
 %--- end of Architecture------
 


\subsubsection{Security}

The question of security for NB-IoT is very critical, since data from sensor devices are sent over wireless network. Since, NB-IoT devices have limited resources, they are more vulnerable to security attacks.\par

NB-IoT derive two security levels from conventional LTE,
namely: 1) Access Strum (AS) and 2) Non Access Stratum (NAS) security. AS establishes security between the UE and the eNB, whereas NAS security is established and managed by the devices and the mobility management entity (MME). AS and NAS provide security that are offered through ciphering and integrity algorithms listed in \cite{3GPPsecurity}. Specifically, 3GPP defines four ciphering algorithms, referred as EPS encryption algorithm (EEAs), and four integrity algorithms, referred as EPS integrity algorithm (EIA). The security configuration is performed after a negotiation between the UE and the eNB or MME, respectively, eNB and the MME have high priority for the ciphering and integrity algorithms, which are finally selected based on the security capabilities of the UE, whereas, NAS security is always configured before AS security, and both encryption and integrity algorithms are applied in NAS, the ciphering in AS is used for RRC and user plane (UP) while the integrity algorithm is applied only to RRC \cite{martinez2019exploring}.

\subsection{Overview of Radio Frequency Parameters}\label{overview of RF}

For the reference in this thesis, we have used various radio frequency parameters to base our analysis, in this subsection we try to explain briefly these metrics, and also provide the acceptable range accepted by 3GPP standars. Furthermore, RSSI, RSRP and RSRQ are categorized into four distinct classes of link quality: POOR, FAIR, GOOD and EXCELLENT according to 3GPP standards \cite{3GPP,sikora2019performance}. The exact corresponding values differ for NB-IoT and Sigfox in the analysis; the respective values have been detailed in Tables \ref{nbiotRSSI}-\ref{sigfoxRSSI} for RSSI;  Table \ref{nbiotRSRP} for RSRP; and Table \ref{nbiotRSRQ} for RSRQ and Table \ref{nbiotSINR} for SINR respectively below.


\subsubsection{Received Signal Strength Indicator}
Received Signal Strength Indicator (RSSI) or "Total  Power", is the radio  signal  strength  within  the  receive bandwidth. It is usually the power received by antenna, and is  calculated in dBm using an equation \ref{RSSI}.

\begin{equation}
      RSSI = {12 \times N \times RSRP}
      \label{RSSI}
\end{equation}
Where, N= Number of PRBs and RSRP is reference signal received power.

%----table 4----
\begin{table}[h]

\centering
\caption {RSSI reference values for NB-IoT as per 3GPP standards \cite{3GPP,sikora2019performance}}

\begin{tabular}{|p{5cm}|p{5cm}|}
\hline
\multicolumn{2}{|c|}{NB-IoT RSSI REFERENCES} \\ \hline
 > −65 dBm                           & EXCELLENT                     \\ \hline
−65 to −75 dBm                      & GOOD                          \\ \hline
−75 to −85 dBm                      & FAIR                          \\ \hline
< -85 dBm                           & POOR                          \\ \hline
\end{tabular}
\label{nbiotRSSI}

\end{table}
%----table 4 ends here----


%----table 5-------
\begin{table}[H]
\caption {RSSI reference values for Sigfox \cite{sigfoxRSSI}}
\centering
\resizebox{0.744\columnwidth}{!}{
\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{SIGFOX RSSI REFERENCES} \\ \hline
> -122dBm                    & EXCELLENT     \\ \hline
-135dBm < RSSI ≤ -122dBm     & GOOD          \\ \hline
-122dBm < RSSI               & GOOD          \\ \hline
\begin{tabular}[c]{@{}c@{}}-135dBm < RSSI ≤ -122dBm\\ (if data received by 1 or 2 base stations)\end{tabular} & FAIR \\ \hline
RSSI ≤ -135dBm               & POOR          \\ \hline
\end{tabular}}
\label{sigfoxRSSI}
\end{table}

%----table 5 ends here----

\subsubsection{Reference Signal Received Power}\label{rsrp}
Reference Signal Received Power (RSRP) is similar to RSSI and refers to the average received power over the resource elements that carry cell-specific reference signals within  certain  frequency  bandwidth. RSRP is applicable to RRC\_idle and RRC\_connected states, refer section \ref{RRC}. It is measured in dBm and is calculated using the equation \ref{RSRP equation}.

\begin{equation}
    RSRP = {{RSSI - 10\times log (12\times N) }}
    \label{RSRP equation}
\end{equation}
Where, 
\begin{itemize}
    \item N = Number of PRBs 
    \item RSSI= Received Signal Strength Indicator(explained above).
\end{itemize}



%---table 6-----
\begin{table}[h]
\caption {RSRP reference values for NB-IoT as per 3GPP standards \cite{3GPP,sikora2019performance}}
\centering

\begin{tabular}{|p{5cm}|p{5cm}|}
\hline
\multicolumn{2}{|c|}{NB-IoT RSRP REFERENCE} \\ \hline
> −84 dBm                            & EXCELLENT                    \\ \hline
−85 to −102 dBm                      & GOOD                         \\ \hline
−103 to −111 dBm                     & FAIR                         \\ \hline
< -112                               & POOR                         \\ \hline
\end{tabular}
\label{nbiotRSRP}
\end{table}

%---table 6 ends here-----



It should be noted in the below results that at higher values of RSRP, the BG96 has not calculated the RSSI, it should not be interpreted as packet loss; the same characteristics have been observed in other radio modules e.g., SARA-N210 \cite{basu2019experimental}, therefore the graphs below have breaks in RSSI values. Therefore, RSRP is a more suitable parameter to be considered. Nevertheless, we have tried to analyse the corresponding RSSI measurement as well whenever possible.

\subsubsection{Reference Signal Received Quality}\label{rsrq}
Reference Signal Received Quality (RSRQ) indicates the quality of received reference signal and is applicable only in RRC\_connected state (refer section \ref{RRC}). It is calculated in dB as per equation \ref{RSRQ equation}. 
\begin{equation}
     RSRQ= {{N\times} RSRP/ RSSI}
     \label{RSRQ equation}
\end{equation}
\\ Where,
\begin{itemize}
    \item N: indicates the number of PRBs.
\end{itemize}

%---table 7 ----
\begin{table}[!h]
\caption {RSRQ reference values for NB-IoT as per 3GPP standards\cite{3GPP,sikora2019performance}}
\centering

\begin{tabular}{|p{5cm}|p{5cm}|}
\hline
\multicolumn{2}{|c|}{NB-IoT RSRQ REFERENCE} \\ \hline
>−5 dB                 & EXCELLENT          \\ \hline
-5 to -8 dB            & GOOD               \\ \hline
-8 to -11 dB           & FAIR               \\ \hline
< -11 dB               & POOR               \\ \hline
\end{tabular}

\label{nbiotRSRQ}
\end{table}
%---table 7 ends here ----

\subsubsection{Signal to Interference Noise Ratio} \label{snr}
Signal to Interference Noise Ratio, is the ratio of signal power and the noise power. It is measured in dB, and calculated using the equation \ref{SINR equation}. \par

\begin{equation}
       SINR={\dfrac{P}{(I+N)}}
     \label{SINR equation}
\end{equation}
where, 
\begin{itemize}
    \item P: indicates the power of reference signal
    \item I: indicates the average interference power
    \item N: indicates the number of PRBs
\end{itemize}

%---table 8 SINR ----
\begin{table}[H]
\caption {SINR reference values for NB-IoT as per 3GPP standards\cite{3GPP,sikora2019performance}}
\centering

\begin{tabular}{|p{5cm}|p{5cm}|}
\hline
\multicolumn{2}{|c|}{NB-IoT SINR REFERENCE} \\ \hline
> 12 dB                 & EXCELLENT          \\ \hline
10 to 12.5 dB            & GOOD               \\ \hline
7 to 10 dB           & FAIR               \\ \hline
< 7 dB               & POOR               \\ \hline
\end{tabular}

\label{nbiotSINR}
\end{table}
%---table 8 ends here ----






\subsection{Related Work}\label{related work}
In this section, we discuss the related works in two sub-sections. First, we provide all the studies and surveys that has been done to best of our knowledge. Followed by discussion, related to coverage analysis involving Sigfox and NB-IoT in the last sub-section.
\subsubsection{Overview and Surveys}
There have been many studies on LPWAN which have described the various available LPWAN technologies and given detailed overviews and insights. In \cite{raza2017low}, the author has compared various LPWAN technologies based on technological specification, network topology, hardware cost and throughput, and in the end, the author concludes from the observation that most of the LPWAN technologies focus on MAC and physical layer and there is still a gap at the upper layer that needs to be bridged, the study also concludes by referencing that all LPWAN technologies have their own pros and cons as per their technological principles. In general, there is not appropriate technology for specific use case; each use case has it's own specific requirement which fits specific technology choice, for e.g., smart metering automatic reading (AMR) solutions prioritize coverage and low power consumption rather than throughput and latency; e-health give preference to high reliability and moderate throughput and minimum latency in the emergency situations. In \cite{mekki2019comparative}, the author has done comparative study on three leading LPWAN technologies: Sigfox, LoRa and NB-IoT for large scale IoT deployments. Their conclusion was Sigfox and LoRa have advantage in terms of long battery life, network deployment and end device cost, while NB-IoT has benefit over in terms of QOS and latency. Similarly, in \cite{morin2017comparison}, the author has published a study on lifetime of devices for various wireless networks in Internet of Things, according to observations both Sigfox and LoRa extend the device lifetime but Sigfox matches to the LoRa mark with small payload which is valuable insight. The authors in \cite{mekki2018overview} made a comprehensive overview of the LPWAN technologies and concluded that Sigfox achieves highest network coverage among all the available LPWAN technologies.\par

\subsubsection{Coverage Analysis on NB-IoT and Sigfox}

Many efforts have been put to compare the various performance of parameters of the LPWAN technologies. In \cite{malik2019nb}, the authors produced empirical results for NB-IoT network trial, but their conclusions were based on only one performance indicator i.e., RSSI. Based on their one-factor conclusions they claimed that NB-IoT provides good connectivity in an indoor and outdoor scenario but do not provide any good performance in deep-indoor/underground scenarios. The same authors in \cite{khan2019dorm}, claimed good performance of NB-IoT coverage in an indoor scenario at different elevation levels, but their conclusions were based on only two factors i.e. RSSI and SNR. Similarly, the authors in \cite{lauridsen2017coverage} produced simulation-based coverage analysis of GPRS, Sigfox, LoRa and NB-IoT for indoor and outdoor scenarios but provided no details on how these simulation-based results could be related to real-world scenarios. However, the same authors in their work \cite{vejlgaard2017coverage} compared the coverage and capacity analysis of SigFox, LoRa, GPRS, and NB-IoT  using a real site deployment covering 8000 km\textsuperscript{2} in Northern Denmark. In \cite{basu2019experimental}, authors produced the empirical results for NB-IoT using the commercial Orange \cite{orange} network in Belgium, their conclusion were based on three network parameters i.e., RSSI, RSRP, and SINR. Based on their analysis they concluded, that NB-IoT is quite robust in terms of low interference, coverage (both outdoor and deep indoor), high reliability with no packet loss even in low signal quality and acceptable latencies. Similarly, in \cite{nolan2016evaluation}, the author had conducted an experiment in Ireland that showed Sigfox end devices were able to communicate to the base station as far as 25 km with a RSSI as high as -145 dB.\par

To summarize, the above studies and experiments, they are limited in the sense that most of the conclusions are based on very few or restricted number of parameters. Table \ref{Summary of all the work carried in coverage analysis} summarizes the the work carried out in coverage analysis in tabular form; (-) represent no information provided.

\begin{table}[H]
\caption{Summary of all the work carried in coverage analysis}
\centering
\resizebox{\columnwidth}{!}{
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
\hline
Reference &
  Technologies &
  Type of Analysis &
  Region &
  Area of observation &
  Number of devices &
  Duration of observation &
  Observation scenario &
  Radio module &
  Metrics \\ [5ex] \hline
\cite{malik2018radio} &
  NB-IoT &
  Empirical &
  Tallinn, Estonia &
  700m &
  20 &
  12 Hours &
  \begin{tabular}[c]{@{}c@{}}Outdoor, Indoor \\ and Deep-Indoor\end{tabular} &
  Quectel BG96 &
  RSSI \\ [5ex]\hline
\cite{khan2019dorm} &
  NB-IoT &
  Empirical &
  Tallinn, Estonia &
  \begin{tabular}[c]{@{}c@{}}In 1 building \\ having 5 floors\end{tabular} &
  - &
  \begin{tabular}[c]{@{}c@{}}12 Hours from (08:00-13:59)\\  and (18:00-23:59)\end{tabular} &
  Indoor &
  Quectel BG96 &
  RSSI and SINR [5ex]\\ [5ex]\hline
\cite{lauridsen2017coverage} &
  \begin{tabular}[c]{@{}c@{}}GPRS, Sigfox, LoRa\\  and NB-IoT\end{tabular} &
  Simulation &
  North Denmark &
  7800 km\textsuperscript{2} &
  170 site &
  - &
  Indoor and Deep-Indoor &
  - &
  \begin{tabular}[c]{@{}c@{}}MCL \\ (Maximum Coupling Loss)\end{tabular} \\ [5ex]\hline
  \cite{vejlgaard2017coverage}&
  \begin{tabular}[c]{@{}c@{}}GPRS, Sigfox, LoRa\\  and NB-IoT\end{tabular} &
  Empirical &
  North Denmark &
  8000 km\textsuperscript{2} &
  - &
  - &
  \begin{tabular}[c]{@{}c@{}}Outdoor, Indoor \\ and Deep-Indoor\end{tabular} &
  - &
  \begin{tabular}[c]{@{}c@{}}MLL \\ (Maximum Link Loss)\end{tabular} \\ [5ex]\hline
\cite{nolan2016evaluation} &
  Sigfox and LoRaWAN &
  Empirical &
  Eastern Ireland &
  3800 km\textsuperscript{2} &
  - &
  - &
  Outdoor &
  - &
  SNR \\[5ex] \hline
\cite{basu2019experimental} &
  NB-IoT &
  Empirical &
  Belgium &
  - &
  - &
  - &
  Outdoor and Deep-Indoor &
  SARA-N210 &
  \begin{tabular}[c]{@{}c@{}}RSSI, SINR \\ and RSRP\end{tabular} \\ [5ex]\hline
\end{tabular}}
\label{Summary of all the work carried in coverage analysis}
\end{table}







\begin{comment}
\begin{table}[H]

\caption{Summary of all the work carried in coverage analysis}
\centering
\resizebox{\columnwidth}{!}{
\begin{tabular}{|c|c|c|c|c|c|}
\hline
Reference & Technologies       & Type of Analysis & Region           & Metrics       \\ \hline
\cite{malik2019nb}     & NB-IoT             & Empirical        & Tallinn, Estonia  & RSSI          \\ \hline
\cite{khan2019dorm}      & NB-IoT             & Empirical        & Tallinn, Estonia & RSSI and SINR \\ \hline
\cite{lauridsen2017coverage} & GPRS, Sigfox, LoRa and NB-IoT & Simulation & North Denmark & MCL (Maximum Coupling Loss) \\ \hline
\cite{vejlgaard2017coverage}     & GPRS, Sigfox, LoRa and NB-IoT & Empirical        & North Denmark  & MLL (Maximum Link Loss)           \\ \hline
\cite{nolan2016evaluation}     & Sigfox and LoRaWAN & Empirical        & Eastern Ireland  & SNR           \\ \hline
\end{tabular}}
\label{Summary of all the work carried in coverage analysis}
\end{table}
\end{comment}



\newpage
\section{Results and Methodology}\label{Results and Methodology}
In this chapter, we present the results and methodology of our coverage campaign in two universities campuses. First, we describe our hardware and cloud platform setup of Sigfox and NB-IoT, and in the end, we present the results of the field test experiments. The purpose of this field-tests is to collect the radio frequency parameters to answer our 3 foremost RQs; to support answers for our RQ1 and RQ2, we conducted series of experiments for duration half/full-day; measured radio frequency parameters at 30 minutes interval at different locations and scenarios, the results have been detailed in sub-section \ref{Outdoor Analysis}, \ref{indoor analysis}, and \ref{deep-indoor analysis}; to answer RQ3, we had implemented a lab condition to see the co-existence interference among the devices, the results have bee detailed in sub-section \ref{interferenceExp}.




\subsection{Experimental Setup}



\begin{figure}[!h]
    \centering
    \includegraphics[width=0.9\columnwidth]{Images/locations.pdf}
    \caption{Location  of  measuring  points  in  Tartu  (Delta and Paabel buildings at  University  of  Tartu,  left)  and  Tallinn (TalTech, right)}
    \label{fig:Observation locations}
\end{figure}


The measurements are done in two universities campuses i.e., University of Tartu, Delta and Paabel building, and in Tallinn University of Technology, Thomas Johann Seebeck Department of Electronics (location in Google map Figure \ref{fig:Observation locations}). As aforementioned, the purpose of these field-tests are to measure the RF values i.e., RSSI in case of Sigfox and RSSI, RSRP, and RSRQ in case of NB-IoT, in three different scenarios i) Outdoor ii) Indoor,and iii) Deep-Indoor. To carry out the experiment, below following hard-wares, devkits were utilized (see Figure \ref{fig:Experimental Setup}); discussed in below subsections respectively \ref{sigfox experimental setup} and \ref{NB-IoT experimental setup}. The observations were recorded at 30 minutes interval for half-day to full day, and from the recorded data we took data samples of 40 uplink transmissions i.e., from 12AM to 5:30PM for analysis; all the measurement values were stored in a single cloud platform Ubidots\footnote{https://ubidots.com/} which offers easy integration using the TCP/UDP and HTTP protocols.


\begin{figure}[H]
    \centering
    \includegraphics[trim=1cm 0cm 2cm 1cm,clip=true,width=0.9\columnwidth,totalheight=7.5cm ,width=0.9\columnwidth,keepaspectratio]{Images/experimentSetup.pdf}
    \caption{Some of the  NB-IoT nodes (uncased) and Sigfox devices (white squared shaped), and batteries}
    \label{fig:Experimental Setup}
\end{figure}
%---fig 23 ends here----------



\subsubsection{Sigfox}\label{sigfox experimental setup}
For our measurement campaign, we have used proprietary Sigfox device Airwits\footnote{https://partners.sigfox.com/products/connected-airwits}, that is class 0, as per the specifications and has a better antenna design and placement which allows us to the field test without worrying about the position and alignment of antenna compared to Pycom-Sipy\footnote{https://pycom.io/product/sipy/} which we initially tested. Each Airwits device is deployed along with other NB-IoT node, transmits data to the nearest base stations in every 30 minutes interval. This data upon receiving at base stations are forwarded to Sigfox core network i.e., Sigfox backend which further forwards the data as a callback\footnote{https://support.sigfox.com/docs/callbacks-documentation} to Ubidots in JSON format that includes the RSSI, SNR, and the timestamps which corresponds to time of arrival of message at Sigfox core network. Figure \ref{fig:Sigfox-Ubidots data flow} refers to the callback settings and Ubidot dashboard and Figure \ref{fig:Sigfox Airwits flowchart} refers to the flow chart explaining the working of the Airwits.



%---Fig 24 Airwits flow chart
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\columnwidth,height=13cm,keepaspectratio]{Images/AirwitsFlowchart.pdf}
    \caption{Sigfox Airwits flowchart}
    \label{fig:Sigfox Airwits flowchart}
\end{figure}
%---fig 25 ends here--------
%---- fig 23-------
\begin{figure}[H]
  \begin{subfigure}[h]{\columnwidth}
  \centering
    \includegraphics[width=0.9\columnwidth,height= 6cm,keepaspectratio]{Images/sigfox-ubidotsArchitecture.pdf}
    \label{fig:Sigfox and Ubidots basic architecture}
    \caption{Sigfox and Ubidots basic architecture}
\end{subfigure}
  
  \begin{subfigure}[t]{\columnwidth}
\centering
    \includegraphics[trim=0.5cm 6cm 1cm 0cm,clip=true,width=0.9\columnwidth,totalheight=6cm,keepaspectratio ]{Images/SigfoxUbidotsCallback.pdf}
    \caption{Ubidots callback definition at Sigox backend}
  \end{subfigure}
  
  
  \begin{subfigure}[t]{\columnwidth}
\centering
    \includegraphics[trim=0.5cm 1cm 2cm 0cm,clip=true,width=0.9\columnwidth,totalheight=6cm,keepaspectratio ]{Images/UbidotsDashboard.pdf}
    \caption{Ubidots dashboard with RF parameters}
  \end{subfigure}
  
    \caption{Sigfox-Ubidots data flow}
    \label{fig:Sigfox-Ubidots data flow}
\end{figure}
%---- fig 23 ends here----


\subsubsection{NB-IoT}\label{NB-IoT experimental setup}
For our measurement campaign, we have used the Avnet Silica NB-IoT shield which is embedded with Quectel BG96 radio chipset that features ultra-low power consumption and supports various communication channels i.e., LTE CAT NB1 (i.e. 3GPP Release 13 NB-IoT) along with other standard interfaces such as USB/UART/I2C/Status Indicator \cite{avnetBG96}. The shield is combined with the STM32 based micro-controller, i.e., Nucleo-L476RG(CORTEX M4) \cite{STM} which is used as the processing unit as they are highly affordable and at the same time supports mbed OS for quick development. To program these devkits we have used $\mu$Vision IDE \footnote{http://www2.keil.com/mdk5/uvision/} and the source code is written in embedded C. Figure \ref{fig:NB-IoT node with Avnet BG96 shield and STM-32 L476RG micro-controller} illustrates the working setup of NB-IoT which is powered by 20,000 mAh external battery. \par

%----fig 25 -------------
\begin{figure}[H]
    \centering
    \includegraphics[trim=1cm 0cm 2cm 1cm,clip=true,width=0.9\columnwidth,totalheight=8cm ,width=0.9\columnwidth,keepaspectratio]{Images/nb-iotNode.pdf}
    \caption{NB-IoT node with Avnet BG96 shield and STM-32 L476RG micro-controller}
    \label{fig:NB-IoT node with Avnet BG96 shield and STM-32 L476RG micro-controller}
\end{figure}
%-----fig25 ends here------

To answer RQ2, we had inserted NB-IoT nodes with narrow band SIM cards from the two different MNO i.e., Telia and Elisa (they have been anonymously referred as operator A and operator B since the aim of the thesis is not to prove one operator to be better than the other), These nodes are programmed to send the RF parameters to Ubidots using the UDP protocol, for 30 minutes interval containing RSSI, SNR, RSRP, RSRQ, and RSRP. The algorithm of the node is designed such a way that it goes into power saving mode (deep-sleep) after transmitting the the packet, thus saving the battery. The working of these nodes are explained by the help of flow chart, see Figure \ref{fig:NB-IoT node code flowchart diagram}. 


%---fig 26 ---nbiot flowchart----
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\columnwidth,height=15cm]{nbiotFlowchart.pdf}
    \caption{NB-IoT node code flowchart diagram}
    \label{fig:NB-IoT node code flowchart diagram}
\end{figure}
%---fig 27 nbiot flow chart ends here---

\subsection{Results}\label{results}
This section evaluates the RF results of Sigfox and NB-IoT in three different scenarios i) Outdoor ii) Indoor, and iii) Deep-Indoor/Basement in two University campuses, University of Tartu and TalTech as aforementioned. The radio coverage depends on link budget and other radio parameters for e.g., transmission power, connector loss, antenna gain, the height of antenna that directly affects the overall coverage. Factors like free space path loss, fading reflection, refraction, building structure, and Fresnel zone also affects the coverage \cite{sikora2019test,sikora2019performance}. Therefore, results are outlined on the basis of 3-factor analysis by considering i) RSSI ii) RSRP and iii) RSRQ of the received signal as explained in the section \ref{overview of RF}.\par

Furthermore, the results have been categorised below into three subsections based on the above three deployment scenarios.

\subsubsection{Coverage Analysis in Outdoor Scenario}\label{Outdoor Analysis}

The test devices were deployed in outside locations of both campuses. Specifically, in case of UT, devices were deployed on the roof top of Delta building; in TalTech campus, devices were deployed in outside campus ground as can be seen in the Figure \ref{fig:Outdoor deployment}.\par



%---figure 28----
\begin{figure}[H]
\centering
\begin{subfigure}[t]{0.42\linewidth}
  \centering
  % include first image
   \includegraphics[width=6cm,height=6cm]{Images/sitePictures/Tartu/outdoor-min.pdf} 
  \caption{UT outdoor scenario}
\end{subfigure}
\begin{subfigure}[t]{0.42\linewidth}
  \centering
  % include second image
  \includegraphics[height=6cm,width=6cm]{Images/sitePictures/Tallinn/outdoor-min.pdf} 
  \caption{TalTech outdoor scenario}
\end{subfigure}

\caption{Outdoor deployment}
 \label{fig:Outdoor deployment}
\end{figure}
%---figure 28 ends here----

Furthermore, Figure \ref{RFOutdoor UT} presents the RF coverage results of $University\ of\  Tartu$ at Delta and Paabel building (refer to Fig. \ref{fig:Observation locations} to see locations on map). During the analysis as per the Table \ref{nbiotRSRP}, it was observed in case of NB-IoT, that $operator\ B$ has slightly better outdoor coverage than $operator\ A $ with average RSRP -91.2 dBm compared to -97.4 dBm, as shown in Figure \ref{boxplot}. For RSSI, $operator\ B$ has shown good performance with average RSSI of -77 dBm at Delta building and -69 dBm RSSI recorded at Paabel building, compared to -90 dBm and -87 dBm, respectively, in case of $operator\ A$, refer Table \ref{nbiotRSSI}. On the other hand, Sigfox the average RSSI values recorded at both locations were -114 dBm and -103 dBm respectively, which reflects excellent coverage as per Table \ref{sigfoxRSSI}. For RSRQ, which is defined as quality of received signal, explained in section \ref{rsrq}, NB-IoT $Operator\ B$ has showed lower RSRQ, -6.9 dB index at Paabel building compared to $operator\ A$, -20.11 dB, this reflects the stronger coverage of $operator\ B$ in comparison to $operator\ A$ (refer Table \ref{nbiotRSRQ}). \par



%----figure 29 tartu outside-----

\begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tartu/ATartuOut.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tartu/BTartuOut.pdf}  
  \caption{NB-IoT Operator B}
\end{subfigure}

\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tartu/STartuOut.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: outdoor scenario at University of Tartu}
 \label{RFOutdoor UT}
\end{figure}
%---figure 29 ends here-----


%---figure 30 tallinn outdoor ---
\begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tallinn/ATallinnOut.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tallinn/BTallinnOut.pdf}  
  \caption{NB-IoT Operator B}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tallinn/STallinnOut.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: outdoor scenario at TalTech}
 \label{RFOutdoor Taltech}
\end{figure}
%---figure 30 tallinn outdoor ends here ---

%-- figure 31 RSRP Boxplot figure
 \begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tallinn/TallinnRSRPboxplot.pdf}  
  \caption{TalTech campus, Tallinn}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tartu/TartuRSRPboxplot.pdf}  
  \caption{University of Tartu campus, Tartu}
  
\end{subfigure}
\caption{Whisker representation of NB-IoT RSRP distribution in Tallinn and Tartu (X represents median within the block)}
 \label{boxplot}
\end{figure}
%-----figure 31 end here-----






In addition to the above, in $Taltech$ Figure \ref{RFOutdoor Taltech}, $operator\ A$ has good coverage with average RSSI value -64 dBM whereas $operator\ B$ has fair coverage with average RSSI value -87 dBm. Similar to RSSI, other parameters RSRP and RSRQ showed similar patterns for $operator\ A$ having median RSRP value -64 dBm compared to -97 dBm in case of $operator\ B$, refer to Figure \ref{boxplot}, and Sigfox on the other hand has good RSSI strength with -101 dBm which reflects excellent coverage as per Table \ref{sigfoxRSSI}.\par
It is important to highlight NB-IoT and Sigfox both had 0\% packet loss for the outdoor scenario.




\subsubsection{Coverage Analysis in Indoor Scenario}\label{indoor analysis}
To observe the indoor coverage, test devices were deployed in 3\textsuperscript{rd} floor of UT's , Delta and Paabel building and similar setup was deployed at 1\textsuperscript{st} and 2\textsuperscript{nd} floor of TalTech's Thomas Johann Seebeck Department of Electronics (see Figure \ref{fig:Indoor deployment}).
%\begin{comment}



\begin{figure}[H]
\centering
\begin{subfigure}{0.49 \linewidth}
  \centering
  \includegraphics[height=6cm,width=6cm,]{Images/sitePictures/Tartu/indoor-min.pdf}
  \caption{UT indoor scenario}
  \end{subfigure}%
  \begin{subfigure}{0.49 \linewidth}
    \centering
    \includegraphics[height=6cm,width=6cm,angle=-90]{Images/sitePictures/Tallinn/indoor}
    \caption{TalTech indoor scenario}
  \end{subfigure}
   
    \caption{Indoor deployment}
    \label{fig:Indoor deployment}
\end{figure}

%\end{comment}

\begin{comment}


%---Figure 32 Indoor deployment-----
\begin{figure}[H]
\centering
\begin{subfigure}{0.49 \linewidth}
  \centering
  \includegraphics[width=6cm,height=5cm,keepaspectratio]{Images/sitePictures/Tartu/indoor-min.pdf}
  \caption{University of Tartu indoor scenario}
  \end{subfigure}%
  
  \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[height=6cm,width=5cm,keepaspectratio]{Images/sitePictures/Tallinn/indoor-min.pdf}
    \caption{TalTech indoor scenario}
  \end{subfigure}
   
    \caption{Indoor deployment}
    \label{fig:Indoor deployment}
\end{figure}
%---Figure 32 ends here-----
\end{comment}
Figure \ref{RFIndoor Tartu} illustrates the RSSI, RSRP and RSRQ values in indoor scenarios in both campuses. In our measurement, at $University\ of\ Tartu$, Delta building, for NB-IoT $operator\ A$, our nodes did not measured any RSSI strength, which is result of RSRP above the threshold value, explained in section \ref{rsrp}. The average RSRP and RSRQ index measured were -128 dBm and -14 dB, which reflects poor coverage as per Table \ref{nbiotRSRP}. However, interestingly, even with weaker coverage strength there were no packet loss which shows NB-IoT reliability and robustness which is due to the fact that a packet can be re-transmitted (up to 128 repetitions in uplink, refer to section \ref{repetition}), which increases the success probability at the price of energy consumption.

%----figure 33 starts here----
 \begin{figure}[h!]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tartu/ATartuIndoor.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tartu/BTartuIndoor.pdf}  
  \caption{NB-IoT Operator B}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tartu/STartuIndoor.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: indoor scenario at UT}
 \label{RFIndoor Tartu}
\end{figure}
%----figure 33 ends here----

It was also observed in Delta building, that with the increase in human occupancy in the building, which is directly proportional to active mobile users, there were fluctuations in the RSSI in both NB-IoT operators, This is due to the many reasons such as sampling rate, inter-PRB interference due to power leakage between NB-IoT and LTE PRBs \cite{mwakwata2019narrowband}. However, the same was not observed with Sigfox, which shows that Sigfox is unaffected by neighboring LTE interference and noises which is due to its ultra narrow band modulation.


%--- figure 34 starts here---
 \begin{figure}[h!]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tallinn/ATallinnIndoor.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tallinn/BTallinnIndoor.pdf}  
  \caption{NB-IoT Operator B}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tallinn/STallinnIndoor.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: indoor scenario at in TalTech}
 \label{RFIndoor Tallinn}
\end{figure}
%--- figure 34 ends here---
Furthermore, at TalTech campus, see Figure \ref{RFIndoor Tallinn}, it was observed that NB-IoT $operator\ A$ had better coverage compared to $Operator\ B$. During the measurement cycle, the average RSRP calculated  was -68 dBm for $Operator\ A$ with respect -88 dBm at level 1 for $operator\ B$. For the same settings at level 2 the average RSRP value for $operator\ B$ increased to -107 dBM compared to -54 dBm in case of $operator\ A$. 


For both campuses in indoor scenario, we have observed few packet losses in Sigfox compared to NB-IoT, which shows that even with weaker signal strength NB-IoT is reliable and resilient.\par

It is important to note that, the values of RSRP were unstable in indoor scenarios compared to outdoor, worst stability was reflected for operator A in deep indoor, refer Figure \ref{boxplot}.

\subsubsection{Coverage Analysis in Deep-Indoor Scenario} \label{deep-indoor analysis}
To observe the coverage in Deep-Indoor scenario we had deployed the test devices in basements or parking spots in Delta and Paabel building of $University of Tartu$ and $Taltech$. The deployment is illustrated through the help of Figure \ref{fig:Deep-Indoor deployment}.

%----figure 35 starts here----
\begin{figure}[H]
\centering
\begin{subfigure}{0.49 \linewidth}
  \centering
  \includegraphics[width=6cm,height=6cm]{Images/sitePictures/Tartu/deepIndoor-min.pdf}
  \caption{UT deep-indoor scenario}
  \end{subfigure}%
  \begin{subfigure}{0.49 \linewidth}
    \centering
    \includegraphics[height=6cm,width=6cm]{Images/sitePictures/Tallinn/depIndoor-min.pdf}
    \caption{TalTech deep-indoor scenario}
  \end{subfigure}
   
    \caption{Deep-Indoor deployment}
    \label{fig:Deep-Indoor deployment}
\end{figure}
%----figure 35 ends here----

Furthermore, Figure \ref{RFDeepIndoorTartu} and Figure \ref{RFDeepIndoorTallinn} presents the RF coverage of NB-IoT and Sigfox in deep-indoor. It is interesting to note that NB-IoT $operator\ A$ had NB outage in $University\ of\ Tartu$ at Delta building. Therefore, it has been assigned value 0 for all corresponding RF parameters. However, on the other hand $operator\ B$ had maximum packet loss of 61\%, followed by Sigfox for same location that had 9\% packet loss. The average RSRP observed, see Figure \ref{boxplot}, at this site was -133 dBm for $operator\ B$ which quantifies to\ poor coverage. In addition to the above, at Paabel building of $University\ of\ Tartu$ there were 33\% of packet loss in case of NB-IoT $Operator\ B$, followed by 0\% packet loss in case of $operator\  A$, which confirms that $operator\ B$ has weaker deep indoor coverage penetration at this location. This observation also confirms, NB-IoT performances are affected by building structure and material used.\par
%---figure 36 starts here----
 \begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tartu/ATartuDeepIndoor.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tartu/BTartuDeepIndoor.pdf}  
  \caption{NB-IoT Operator B}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tartu/STartuDeepIndoor.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: deep indoor scenario in UT}
 \label{RFDeepIndoorTartu}
\end{figure}
%---figure 36 ends here----

It is also important to note, the coverage of NB-IoT $operator\ B$ drastically deteriorated in Paabel building during the working hours by 22 dBm in RSRP; similar pattern is seen in other parameters also, i.e., RSRQ and RSSI, where difference is 24 dB and 14 dBm respectively compare to working hours with non-working hours.\par

Furthermore, the same outage and high packet loss was not observed in TalTech campus for NB-IoT which shows both operators $operator\ A$ and $operator\ B$ have dense narrow band network in that area at the time of writing this thesis.





%---figure 37 starts here----
 \begin{figure}[H]
\begin{subfigure}[t]{\linewidth}
  \centering
  % include first image
  \includegraphics[width=.5\linewidth]{Images/tallinn/ATallinnDeepIndoor.pdf}  
  \caption{NB-IoT Operator A}
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include second image
  \includegraphics[width=.5\linewidth]{Images/tallinn/BTallinnDeepIndoor.pdf}  
  \caption{NB-IoT Operator B}
  
\end{subfigure}
\begin{subfigure}[t]{\linewidth}
  \centering
  % include third image
  \includegraphics[width=.5\linewidth]{Images/tallinn/STallinnDeepIndoor.pdf}  
\caption{Sigfox}
 \end{subfigure}
\caption{RF coverage and signal quality: deep indoor scenario in TalTech}
 \label{RFDeepIndoorTallinn}
\end{figure}


%---figure 37 ends here----
\newpage \subsubsection{Interference Analysis in Co-existence scenario} \label{interferenceExp}
Predicting interference, estimation or cancellation of inferences for NB-IoT is challenging. This is due to the sharing of spectrum resources between NB-IoT and conventional LTE, co-existence interference due to neighboring devices, inferences due to small and macro cells; and interference due to environmental and surrounding conditions are some of the main causes of inferences \cite{mwakwata2019narrowband}. To observe this behavior, an experiment was conducted where 9 UEs were deployed in single room; in two cluster A (with 8 UEs) and B (with 1 UE); a distance of approx 5m was maintained from each other as shown in Figure \ref{fig:Example of device deployment in heterogeneous case}.\par

%---figure 38 starts here----
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\linewidth]{Images/hetrogenousCase.pdf}
    \caption{Co-existence case, cluster A (with 8 UEs) and cluster B (with 1 UE) arrangement}
    \label{fig:Example of device deployment in heterogeneous case}
\end{figure}
%---figure 38 ends here----
%---figure 39 starts here----
\begin{figure}[h]
    \centering
    \includegraphics[width=.8\linewidth]{Images/SINRBoxplot.pdf}
    \caption{Whisker representation of NB-IoT SINR distribution in co-existence scenario (X represents median within the block)}
    \label{fig:SINR distribution}
\end{figure}
%---figure 39 ends here----

Figure \ref{fig:SINR distribution} present the signal to interference noise ratio distribution for co-existence scenario, created in TalTech lab. During the analysis, it was observed, $operator\ A$, the median SINR ratio for cluster A was 14 dB compare to 17.8 dB in case of cluster B; a difference of 3.8 dB. For similar setup in case of $operator\ B$, a difference of 4 dB was recorded for $operator\ B$; this indicates co-existence interference between the neighboring devices do exist during the deployment scenarios.

\subsubsection{Summary}


 The results prove that, the radio parameters changes with respect to many physical factors like building structure, deployment scenarios, building occupancy in terms of active mobile users e.t.c, in indoor scenario, we had observed fluctuations in RSSI in both operators during the working hours; also similar observations were noticed in RSRP and RSRQ in deep-indoor scenarios. This indicates, the traffic from the active LTE users and neighboring small and macro cells affects the NB-IoT signal strengths, since they all are deployed in same PRB as discussed in section \ref{NB-IoT Technology} but similar fluctuation were not observed in Sigfox, due to the fact, it uses UNB technology  as discussed in section \ref{sigfox technical}.\par

In indoor scenario, another most phenomenon case was observed at Delta building of University of Tartu, where there were no packet losses even though with very weaker coverage strength. This indicates NB-IoT is reliable over other competitive LPWAN technologies. However, this feature comes at the price of energy consumption due to repetitions of packets as we discussed previously in section \ref{NB-IoT Technology}. Futhermore, it was noted a important observation, some spots at University of Tartu had NB-IoT outages in-spite of good LTE coverage strength which indicates NB-IoT device registration depends on PRB of base station; also on deployment scheme i.e., in band, guard band or standalone configured by the MNO. \par

In deep-indoor coverage, the results were not impressive in UT campus; at UT the both operators had outages or packet losses as high as 61\%. The packet losses were more in Paabel compare to Delta building which indicates thick walls contribute to higher radio penetration losses as compare to newer dwelling structures. Similar observation were not recorded at TalTech campus which further indicates that there is dense narrow band coverage in Tallinn compare to Tartu at the time of writing this thesis.\par

As for the outdoor coverage, it was observed that both technologies; sigfox and NB-IoT had a good to excellent coverage with 0\% packet losses in both campuses locations which was expected.\par
These above inferences helped us to answer our RQ1 and RQ2, whose objective was to see how these LPWAN technologies perform in various scenarios and how these results are affected within the different mobile network operators (MNOs).

To understand, the interference, among the co-existence deployment condition we measured the SINR parameter (detailed in section \ref{snr}) of two small clusters A and B, it was observed that SINR median value were higher for cluster B compared to cluster A (containing signgle device). Although, the difference is not so high considering our small scale setup, but this helped us to infer; interference due to co-existence deployment exists, thus answers to our RQ3. 

One thing important to note is, these results were taken in urban cities of Estonia, one can expect different measurements depending on the size of city, mobile coverage density, building structure, urban planning of the city, e.t.c., However, these measurements can be considered as reference points for future scale of the study.
\newpage
\section{Conclusion and Future Work} \label{conclusion}
 
This thesis provided the comprehensive technical over view, along withe real-time coverage analysis of NB-IoT and Sigfox in two university campuses of Estonia in two main cities (Tartu and Tallinn). We have based our analysis on multiple RF parameters since, RSSI is most of the time not sufficient for evaluating LTE-based technologies including NB-IoT. Thus, our investigation of NB-IoT coverage considers three parameters:  RSSI,RSRP, and RSRQ. Sigfox, being a non-LTE technology, we based our coverage analysis only on the RSSI factor. These technologies were evaluated in different scenarios indoor, outdoor and deep-indoor/underground environments to better comprehend their radio parameters so as to provide an understanding of their coverage in various propagation and penetration conditions. Our results proved that, in outdoor scenarios, both Sigfox and NB-IoT achieved good to excellent coverage with almost0\% packet losses. However, in indoor scenarios, few packet losses were observed in Sigfox while no packet losses were observed in NB-IoT, even with a weaker coverage, possibly due to re-transmissions which makes NB-IoT more reliable than its competitive LPWAN technologies. However, in deep-indoor or underground scenarios, coverage outages were recorded for NB-IoT, especially in Tartu area, indicating its weaker coverage in that city.\par

These results can be further used as a reference point by operators, telecom engineers, students and researchers who are currently working on or interested in LPWAN technology.\par 

As a part of future works, there are many research topics that can be carried further:
\begin{itemize}
    \item In this research, we have only considered the uplink messages, it will be interesting to see the results for down-link messages.
    \item Due to time constraint, only results were produced in two location, it can further be extended to other locations with different hardware setups.
    \item Future works can also involve optimizing the energy consumption and proposing the optimisation algorithms to enhance the battery life of these LPWAN devices.
    \item Another extension of the work can be done in security of Sigfox, as mentioned, the application layer of Sigfox is left to end user for encryption and this vulnerability has high security risks. 
    \item Another area of research could be with over the air firmware updates for various LPWAN technologies as most popular ones supports bi-directional communication.

\end{itemize}


\emph{The work carried out in this thesis is submitted as a research paper titled "Coverage Analysis of NB-IoT and Sigfox: Two Estonian University Campuses as a Case Study" in 16\textsuperscript{th} International  Wireless Communications \& Mobile Computing Conference (IWCMC 2020), submitted in February 2020; status is under review.}




% BibTeX bibliography
%\bibliographystyle{alpha} %plain=[1], alpha=[BGZ09]
%\bibliography{bachelor-thesis}

\addcontentsline{toc}{section}{\refname}


\newpage
%\appendix
%\section*{\appendixname}
\iflanguage{english}%
  {\section*{Appendix}
  \addcontentsline{toc}{section}{Appendix}
  }%
  {\section*{Lisad}
  \addcontentsline{toc}{section}{Lisad}}


\section*{I. Glossary}
\addcontentsline{toc}{subsection}{I. Glossary}

\begin{table}[H]
\resizebox{0.5\columnwidth}{!}{
\begin{tabular}{ll}
3GPP         & Third Generation Partnership Project          \\
APAC         & Asia Pacific Region                           \\
AS           & Access Strum                                  \\
ASK          & Amplitude Shift Keying                        \\
BPSK         & Binary Phase-shift Keying                     \\
CSS          & Chirp Spread Spectrum                         \\
DBPSK        & Differential Binary Phase Shift Keying        \\
eDRX         & Extended Discontinuous Receive                \\
EMEA         & Europe Middle East and Africa Region          \\
eNB - eNodeB & E-UTRAN Node B                                \\
FSK          & Frequency Shift Keying                        \\
GPRS         & General Packet Radio Service                  \\
IoT          & Internet of Things                            \\
IP           & Internet Protocol                             \\
LoRa         & Long Range                                    \\
LPWAN        & Low-Power Wide-Area-Network                   \\
LTE          & Long Term Evolution                           \\
M2M          & Machine to Machine                            \\
MCL          & Maximum Coupling Loss                         \\
MNO          & Mobile Network Operator                       \\
OFDMA        & Orthogonal Frequency Division Multiple Access \\
PRB          & Physical Resource Block                       \\
PS           & Packet Switched                               \\
PSK          & Phase Shift Keying                            \\
QAM          & Quadrature Amplitude Modulation               \\
QoS          & Quality of Service                            \\
QPSK         & Quadrature Phase Shift Keying                 \\
RAN          & Radio Access Network                          \\
RF           & Radio Frequency                               \\
RRC          & Radio Resource Control                        \\
RSRP         & Received Signal Received Power                \\
RSRQ         & Reference Signal Received Quality             \\
RSSI         & Received Signal Strength Indicator            \\
SIM          & Subscriber Identity Module                    \\
SINR         & Signal to Interference Noise Ratio            \\
TalTech      & Tallinn University of Technology              \\
TCP          & Transmission Control Protocol                 \\
UART         & Universal Asynchronous Receiver Transmitter   \\
UDP          & User Datagram Protocol                        \\
UNB          & Ultra Narrow Band                             \\
UT           & University of Tartu                          
\end{tabular}}
\end{table}
\newpage

%=== Licence in English
\newcommand{\licencehint}[2]{\\\hspace*{#1}\textsl(#2)\par}
\newcommand\EngLicence{{%
\selectlanguage{english}
\section*{III. Licence}

\addcontentsline{toc}{subsection}{III. Licence}

\subsection*{Non-exclusive licence to reproduce thesis and make thesis public}

I, \textbf{Nishant Poddar}, %author's name
  \licencehint{10mm}{author's name}

\begin{enumerate}
\item
herewith grant the University of Tartu a free permit (non-exclusive licence) to
\par
reproduce, for the purpose of preservation, including for adding to the DSpace digital archives until the expiry of the term of copyright,
\par
\textbf{ Coverage Analysis of LPWAN in Estonia:Sigfox and NB-IoT Case study in Tallinn and Tartu}, %
  \licencehint{10mm}{title of thesis}
\par
supervised by Jakob Mass and co-supervised by Sikandar Zulqarnain Khan. %supervisor's name
  \licencehint{10mm}{supervisor's name}
\item
I grant the University of Tartu a permit to make the work specified in p. 1 available to the public via the web environment of the University of Tartu, including via the DSpace digital archives, under the Creative Commons licence CC BY NC ND 3.0, which allows, by giving appropriate credit to the author, to reproduce, distribute the work and communicate it to the public, and prohibits the creation of derivative works and any commercial use of the work until the expiry of the term of copyright.
\item
I am aware of the fact that the author retains the rights specified in p. 1 and 2.
\item
I certify that granting the non-exclusive licence does not infringe other persons' intellectual property rights or rights arising from the personal data protection legislation. 
\end{enumerate}

\noindent
Nishant Poddar\\ %author's name
\textbf{\textsl{12/03/2020}}
}}%\newcommand\EngLicence


%=== Licence in Estonian
\newcommand\EstLicence{{%
\selectlanguage{estonian}
\section*{II. Litsents}

\addcontentsline{toc}{subsection}{II. Litsents}

\subsection*{Lihtlitsents lõputöö reprodutseerimiseks ja üldsusele kättesaadavaks tegemiseks}

Mina, \textbf{Alice Cooper}, %author's name
  \licencehint{10mm}{autori nimi}

\begin{enumerate}
\item
annan Tartu Ülikoolile tasuta loa (lihtlitsentsi) minu loodud teose
\par
\textbf{Tüübituletus neljandat järku loogikavalemitele}, %title of thesis
    \licencehint{10mm}{lõputöö pealkiri}
\par
mille juhendaja(d) on Axel Rose ja May Flower, %supervisor's name(s)
  \licencehint{10mm}{juhendaja nimi}
\par
reprodutseerimiseks eesmärgiga seda säilitada, sealhulgas lisada digitaalarhiivi DSpace kuni autoriõiguse kehtivuse lõppemiseni.
\par
\item
Annan Tartu Ülikoolile loa teha punktis 1 nimetatud teos üldsusele kättesaadavaks Tartu Ülikooli veebikeskkonna, sealhulgas digitaalarhiivi DSpace kaudu Creative Commonsi litsentsiga CC BY NC ND 3.0, mis lubab autorile viidates teost reprodutseerida, levitada ja üldsusele suunata ning keelab luua tuletatud teost ja kasutada teost ärieesmärgil, kuni autoriõiguse kehtivuse lõppemiseni.
\item
Olen teadlik, et punktides 1 ja 2 nimetatud õigused jäävad alles ka autorile.
\item
Kinnitan, et lihtlitsentsi andmisega ei riku ma teiste isikute intellektuaalomandi ega isikuandmete kaitse õigusaktidest tulenevaid õigusi. 
\end{enumerate}

\noindent
Nishant Poddar\\ %author's name
\textbf{\textsl{pp.kk.aaaa}}
}}%\newcommand\EstLicence


%===Choose the licence in active language
\iflanguage{english}{\EngLicence}{\EstLicence}
\newpage

%\bibliographystyle{unsrtnat}
\bibliographystyle{vancouver}

\bibliography{reference}


\end{document}

